/*
**  ComponentJS -- Component System for JavaScript <http://componentjs.com>
**  Copyright (c) 2009-2013 Ralf S. Engelschall <http://engelschall.com>
**
**  This Source Code Form is subject to the terms of the Mozilla Public
**  License, v. 2.0. If a copy of the MPL was not distributed with this
**  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

(function(m,r,p){var b=function(){},e=function(){return b.hook("ComponentJS:lookup","pass",b.lookup.apply(m,arguments))};e.pattern={};e.symbol=function(){var a;a=void 0;var c=null;return function(b){null!==c&&(m[c]=a);"undefined"===typeof b||""===b?c=null:(c=b,a=m[c],m[c]=e);return e}}();e.ns=function(a,c){if("string"!==typeof a||""===a)throw"invalid namespace path";var b=a.split("."),f=b.length;"undefined"!==typeof c&&f--;for(var g=0,e=m;g<f;)"undefined"===typeof e[b[g]]&&(e[b[g]]={}),e=e[b[g++]];
"undefined"!==typeof c&&(e=e[b[g]]=c);return e};e.version={major:1,minor:0,micro:0,date:20130929};b.exception=function(a,c){var b;0<e.debug()&&"object"===typeof m.console&&("function"===typeof m.console.trace?m.console.trace():"undefined"!==typeof m.printStackTrace&&"function"===typeof m.console.log&&(b=m.printStackTrace(),m.console.log(b.join("\n"))));return Error("[ComponentJS]: ERROR: "+a+": "+c)};b.log=function(a){b.hook("ComponentJS:log","or",a)||("undefined"!==typeof m.console&&"undefined"!==
typeof m.console.log?m.console.log("[ComponentJS]: "+a):"undefined"!==typeof m.Titanium&&"undefined"!==typeof m.Titanium.API&&"function"===typeof m.Titanium.API.log&&m.Titanium.API.log("[ComponentJS]: "+a))};e.debug=function(){var a=9;return function(c,d){if(0===arguments.length)return a;if(1===arguments.length)a=c;else if(c<=a){for(var f="",g=1;g<c;g++)f+="    ";b.log("DEBUG["+c+"]: "+f+d)}}}();e.nop=function(){};b.annotation=function(a,c,b){var f=null;c="__ComponentJS_"+c+"__";"undefined"!==typeof a&&
null!==a&&("undefined"!==typeof a[c]&&(f=a[c]),"undefined"!==typeof b&&(null!==b?a[c]=b:delete a[c]));return f};b.isdefined=function(a){return"undefined"!==typeof a};b.isown=function(a,c){var b=Object.hasOwnProperty.call(a,c);if("constructor"===c||"prototype"===c)b=b&&Object.propertyIsEnumerable.call(a,c),-1!==a[c].toString().indexOf("[native code]")&&(b=!1);return b};b.istypeof=function(a){var c=typeof a;"object"===c?null===a?c="null":"[object String]"===Object.prototype.toString.call(a)?c="string":
"[object Number]"===Object.prototype.toString.call(a)?c="number":"[object Boolean]"===Object.prototype.toString.call(a)?c="boolean":"[object Function]"===Object.prototype.toString.call(a)?c="function":"[object Array]"===Object.prototype.toString.call(a)?c="array":null!==b.annotation(a,"type")&&(c=b.annotation(a,"type")):"function"===c&&null!==b.annotation(a,"type")&&(c=b.annotation(a,"type"));return c};b.keysof=function(a){var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c};b.json=function(){var a=
/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},d=function(b){a.lastIndex=0;return a.test(b)?'"'+b.replace(a,function(a){var b=c[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'},f=function(a,c){if("boolean"!==typeof a&&"number"!==typeof a&&"string"!==typeof a){if("undefined"!==typeof c[a])return"null /* CYCLE! */";
c[a]=!0}switch(typeof a){case "boolean":a=String(a);break;case "number":a=isFinite(a)?String(a):"NaN";break;case "string":a=d(a);break;case "function":a=null!==b.annotation(a,"type")?"<"+b.annotation(a,"type")+">":"<function>";break;case "object":var f=[];if(null===a)a="null";else if(null!==b.annotation(a,"type"))a="<"+b.annotation(a,"type")+">";else if("[object Function]"===Object.prototype.toString.call(a))a="<function>";else if("[object Array]"===Object.prototype.toString.call(a)||a instanceof
Array){for(var e=0;e<a.length;e++)f[e]=arguments.callee(a[e],c);a=0===f.length?"[]":"["+f.join(",")+"]"}else{for(e in a)if(Object.hasOwnProperty.call(a,e)){var n=arguments.callee(a[e],c);f.push(d(e)+":"+n)}a=0===f.length?"{}":"{"+f.join(",")+"}"}break;default:a="<unknown>"}return a};return function(a){return f(a,{})}}();b.clone=function(a,c){if("undefined"===typeof c)c=function(){return!0};else if("string"===typeof c){var d=c;c=function(a){return a.match(d)}}var f=arguments.callee,g=function(a,c){var d=
function(){return a.apply(this,arguments)};d.prototype=a.prototype;for(var e in a)b.isown(a,e)&&(c(e,a)?d[e]=f(a[e],c):d[e]=a[e]);b.annotation(d,"clone",!0);return d},e;e=void 0;if("function"===typeof a)e=g(a,c);else if("object"===typeof a)if(null===a)e=null;else if("[object String]"===Object.prototype.toString.call(a))e=""+a.valueOf();else if("[object Number]"===Object.prototype.toString.call(a))e=0+a.valueOf();else if("[object Boolean]"===Object.prototype.toString.call(a))e=!!a.valueOf();else if("[object Function]"===
Object.prototype.toString.call(a))e=g(a,c);else if("[object Date]"===Object.prototype.toString.call(a))e=new Date(a.getTime());else if("[object RegExp]"===Object.prototype.toString.call(a))e=RegExp(a.source);else if("[object Array]"===Object.prototype.toString.call(a)){g=a.length;e=[];for(var h=0;h<g;h++)e.push(f(a[h],c))}else{e={};for(h in a)"constructor"!==h&&b.isown(a,h)&&(c(h,a)?e[h]=f(a[h],c):e[h]=a[h]);"function"===typeof a.constructor&&(e.constructor=a.constructor);"object"===typeof a.prototype&&
(e.prototype=a.prototype)}else e=a;return e};b.extend=function(a,c,d){if("undefined"===typeof d)d=function(){return!0};else if("string"===typeof d){var f=d;d=function(a){return a.match(f)}}for(var e in c)b.isown(c,e)&&d(e,c[e])&&(a[e]=c[e]);return a};b.mixin=function(a,c,d){if("undefined"===typeof d)d=function(){return!0};else if("string"===typeof d){var f=d;d=function(a){return a.match(f)}}for(var e in c)if(b.isown(c,e)&&d(e,c[e]))if("function"===b.istypeof(c[e])){var k=b.clone(c[e],d);b.annotation(k,
"name",e);"function"===b.istypeof(a[e])&&b.isown(a,e)&&b.annotation(k,"base",a[e]);a[e]=k}else a[e]=c[e];return a};b.concat=function(){for(var a=[],c=0;c<arguments.length;c++)for(var b=arguments[c],f=0;f<b.length;f++)a.push(b[f]);return a};b.slice=function(a,c,b){var f=[];"undefined"===typeof b&&(b=a.length);for(;c<b;c++)f.push(a[c]);return f};b.map=function(a,c){for(var b=[],f=0;f<a.length;f++)b.push(c(a[f],f));return b};b.filter=function(a,c){for(var b=[],f=0;f<a.length;f++)c(a[f],f)&&b.push(a[f]);
return b};b.foreach=function(a,c){for(var b=0;b<a.length;b++)c(a[b],b)};b.token=function(){this.text="";this.tokens=[];this.len=this.pos=0};b.token.prototype={setText:function(a){this.text=a},addToken:function(a,c,b,f,e){this.tokens.push({b1:a,b2:c,e2:b,e1:f,symbol:e});this.len++},peek:function(a){"undefined"===typeof a&&(a=0);if(a>=this.len)throw Error("parse error: not enough tokens");return this.tokens[this.pos+a].symbol},skip:function(a){"undefined"===typeof a&&(a=1);if(a>this.len)throw Error("parse error: not enough tokens available to skip: "+
this.ctx());this.pos+=a;this.len-=a},consume:function(a){if(0>=this.len)throw Error("parse error: no more tokens available to consume: "+this.ctx());if(this.tokens[this.pos].symbol!==a)throw Error('parse error: expected token symbol "'+a+'": '+this.ctx());this.pos++;this.len--},ctx:function(a){"undefined"===typeof a&&(a=78);var c=this.tokens[this.pos],b="<"+this.text.substr(c.b2,c.e2-c.b2+1)+">",b=this.text.substr(c.b1,c.b2-c.b1)+b,b=b+this.text.substr(c.e2,c.e1-c.e2);a-=b.length;if(0<a){a=Math.floor(a/
2);var f;if(0<this.pos){var e=0;for(f=this.pos-1;0<=f;f--){c=this.tokens[f];c=this.text.substr(c.b1,c.e1-c.b1+1);e+=c.length;if(e>a)break;b=c+b}0<f&&(b="[...]"+b)}if(1<this.len){e=0;for(f=this.pos+1;f<this.pos+this.len;f++){c=this.tokens[f];c=this.text.substr(c.b1,c.e1-c.b1+1);e+=c.length;if(e>a)break;b+=c}f<this.pos+this.len&&(b+="[...]")}}return b=b.replace(/\r/,"\\r").replace(/\n/,"\\n").replace(/\t/,"\\t")}};e.validate=function(a,c,d){var f;d||(f=b.validate_cache[c]);"undefined"===typeof f&&(f=
b.validate_compile(c));d||(b.validate_cache[c]=f);return b.validate_executor.exec_spec(a,f)};b.validate_cache={};b.validate_compile=function(a){a=b.validate_tokenize(a);return b.validate_parser.parse_spec(a)};b.validate_tokenize=function(a){var c=new b.token;c.setText(a);for(var d,f=0;""!==a;){d=a.match(/^(\s*)([^{}\[\]:,?*+()!|\s]+|[{}\[\]:,?*+()!|])(\s*)/);if(null===d)throw Error('parse error: cannot further canonicalize: "'+a+'"');c.addToken(f,f+d[1].length,f+d[1].length+d[2].length-1,f+d[0].length-
1,d[2]);a=a.substr(d[0].length);f+=d[0].length}return c};b.validate_parser={parse_spec:function(a){if(0>=a.len)return null;var c=a.peek();if("!"===c)a=this.parse_not(a);else if("("===c)a=this.parse_group(a);else if("{"===c)a=this.parse_hash(a);else if("["===c)a=this.parse_array(a);else if(c.match(/^(?:null|undefined|boolean|number|string|function|object)$/))a=this.parse_primary(a);else if(c.match(/^(?:clazz|trait|component)$/))a=this.parse_special(a);else if("any"===c)a=this.parse_any(a);else if(c.match(/^[A-Z][_a-zA-Z$0-9]*$/))a=
this.parse_class(a);else throw Error('parse error: invalid token symbol: "'+a.ctx()+'"');return a},parse_not:function(a){a.consume("!");a=this.parse_spec(a);return a={type:"not",op:a}},parse_group:function(a){a.consume("(");for(var c=this.parse_spec(a);"|"===a.peek();){a.consume("|");var b=this.parse_spec(a),c={type:"or",op1:c,op2:b}}a.consume(")");return c},parse_hash:function(a){a.consume("{");for(var c=[];"}"!==a.peek();){var b=this.parse_key(a),f=this.parse_arity(a,"?");a.consume(":");var e=this.parse_spec(a);
c.push({type:"element",key:b,arity:f,element:e});if(","===a.peek())a.skip();else break}c={type:"hash",elements:c};a.consume("}");return c},parse_array:function(a){a.consume("[");for(var c=[];"]"!==a.peek();){var b=this.parse_spec(a),f=this.parse_arity(a,"?*+");c.push({type:"element",element:b,arity:f});if(","===a.peek())a.skip();else break}c={type:"array",elements:c};a.consume("]");return c},parse_primary:function(a){var c=a.peek();if(!c.match(/^(?:null|undefined|boolean|number|string|function|object)$/))throw Error('parse error: invalid primary type "'+
c+'"');a.skip();return{type:"primary",name:c}},parse_special:function(a){var c=a.peek();if(!c.match(/^(?:clazz|trait|component)$/))throw Error('parse error: invalid special type "'+c+'"');a.skip();return{type:"special",name:c}},parse_any:function(a){var c=a.peek();if("any"!==c)throw Error('parse error: invalid any type "'+c+'"');a.skip();return{type:"any"}},parse_class:function(a){var c=a.peek();if(!c.match(/^[A-Z][_a-zA-Z$0-9]*$/))throw Error('parse error: invalid class type "'+c+'"');a.skip();return{type:"class",
name:c}},parse_arity:function(a,c){var b=[1,1];if(5<=a.len&&"{"===a.peek(0)&&a.peek(1).match(/^[0-9]+$/)&&","===a.peek(2)&&a.peek(3).match(/^(?:[0-9]+|oo)$/)&&"}"===a.peek(4))b=[parseInt(a.peek(1),10),"oo"===a.peek(3)?Number.MAX_VALUE:parseInt(a.peek(3),10)],a.skip(5);else if(1<=a.len&&1===a.peek().length&&0<=c.indexOf(a.peek())){switch(a.peek()){case "?":b=[0,1];break;case "*":b=[0,Number.MAX_VALUE];break;case "+":b=[1,Number.MAX_VALUE]}a.skip()}return b},parse_key:function(a){var c=a.peek();if(!c.match(/^[_a-zA-Z$][_a-zA-Z$0-9]*$/))throw Error('parse error: invalid key "'+
c+'"');a.skip();return c}};b.validate_executor={exec_spec:function(a,c){var b=!1;if(null!==c)switch(c.type){case "not":b=this.exec_not(a,c);break;case "or":b=this.exec_or(a,c);break;case "hash":b=this.exec_hash(a,c);break;case "array":b=this.exec_array(a,c);break;case "primary":b=this.exec_primary(a,c);break;case "special":b=this.exec_special(a,c);break;case "class":b=this.exec_class(a,c);break;case "any":b=!0;break;default:throw Error('validation error: invalid validation AST: node has unknown type "'+
c.type+'"');}return b},exec_not:function(a,c){return!this.exec_spec(a,c.op)},exec_or:function(a,c){return this.exec_spec(a,c.op1)||this.exec_spec(a,c.op2)},exec_hash:function(a,c){var b,f,e="object"===typeof a,k={};if(e)for(b=0;b<c.elements.length;b++)if(f=c.elements[b],k[f.key]=f.element,0<f.arity[0]&&"undefined"===typeof a[f.key]){e=!1;break}if(e)for(var h in a)if(Object.hasOwnProperty.call(a,h)&&Object.propertyIsEnumerable.call(a,h)&&"constructor"!==h&&"prototype"!==h&&("undefined"===typeof k[h]||
!this.exec_spec(a[h],k[h]))){e=!1;break}return e},exec_array:function(a,b){var d,f,e="object"===typeof a&&a instanceof Array;if(e){var k=0;for(d=0;d<b.elements.length;d++){f=b.elements[d];for(var h=0;h<f.arity[1]&&k<a.length&&this.exec_spec(a[k],f.element);)h++,k++;if(h<f.arity[0]){e=!1;break}}k<a.length&&(e=!1)}return e},exec_primary:function(a,b){return"null"===b.name&&null===a||typeof a===b.name},exec_class:function(a,b){return"object"===typeof a&&Object.prototype.toString.call(a)==="[object "+
b.name+"]"||eval("value instanceof "+b.name)},exec_special:function(a,c){var d=!1;typeof a===("component"===c.name?"object":"function")&&(d=b.annotation(a,"type")===c.name);return d}};e.params=function(a,c,d){b.hook("ComponentJS:params:"+a+":enter","none",{args:c,spec:d});var f={},g=0,k=0,h={},l;for(l in d)b.isown(d,l)&&("undefined"!==typeof d[l].pos&&(h[d[l].pos]=l,"number"===typeof d[l].pos&&g++,"undefined"!==typeof d[l].req&&d[l].req&&k++),"undefined"!==typeof d[l].def&&(f[l]=d[l].def));var n=
!1;if(1===c.length&&"object"===b.istypeof(c[0]))for(l in n=!0,c[0])b.isown(c[0],l)&&"undefined"===typeof d[l]&&(n=!1);var q=function(a,c,d,f){if("string"===typeof f){if(!e.validate(d,f))throw b.exception(a,'value of parameter "'+c+'" not valid');}else if("object"===typeof f&&f instanceof RegExp){if("string"!==typeof d||!d.match(f))throw b.exception(a,'value of parameter "'+c+'" not valid (regexp)');}else if("function"===typeof f&&!f(d))throw b.exception(a,'value of parameter "'+c+'" not valid (callback)');
};if(n){g=c[0];for(l in g)if(b.isown(g,l)){if("undefined"===typeof d[l])throw b.exception(a,'unknown parameter "'+l+'"');q(a,l,g[l],d[l].valid);f[l]=g[l]}for(l in d)if(b.isown(d,l)&&"undefined"!==typeof d[l].req&&d[l].req&&"undefined"===typeof g[l])throw b.exception(a,'required parameter "'+l+'" missing');}else{if(c.length<k)throw b.exception(a,"invalid number of arguments (at least "+k+" required)");for(l=0;l<g&&l<c.length;l++)q(a,h[l],c[l],d[h[l]].valid),f[h[l]]=c[l];if(l<c.length){if("undefined"===
typeof h["..."])throw b.exception(a,"too many arguments provided");for(g=[];l<c.length;l++)q(a,h["..."],c[l],d[h["..."]].valid),g.push(c[l]);f[h["..."]]=g}}b.hook("ComponentJS:params:"+a+":leave","none",{args:c,spec:d,params:f});return f};b.base16_number=function(a,b,d){var f="";"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=!1);for(d=d?"0123456789ABCDEF":"0123456789abcdef";0<a||0<b;)f=d.charAt(Math.floor(a%16))+f,a=Math.floor(a/16),0<b&&b--;return f};b.cid=function(){var a=[0,0,0,0];return function(){a[3]++;
for(var c=0,d=3;0<=d;d--)c+=a[d],a[d]=Math.floor(c%4294967296),c=Math.floor(c/4294967296);return b.base16_number(a[0],8,!0)+b.base16_number(a[1],8,!0)+b.base16_number(a[2],8,!0)+b.base16_number(a[3],8,!0)}}();b.proxy=function(a,c,d){"string"===b.istypeof(c)&&"object"===b.istypeof(a)&&"function"===b.istypeof(a[c])&&(c=a[c]);b.isdefined(d)||(d=!1);var f=function(){var e=function(){"object"===b.istypeof(arguments.callee.__ctx__)&&(arguments.callee.__ctx__.__this__=this);return c.apply(arguments.callee.__ctx__,
arguments)};e.__ctx__=d?b.clone(b.isdefined(this.__ctx__)?this.__ctx__:a):a;d&&(e.clone=f);e.guid=c.guid=c.guid||e.guid||b.cid();return e};return f.call({})};b.memoize=function(a){var c=function(){var c=b.json(b.slice(arguments,0)),f;"undefined"!==typeof arguments.callee.cache[c]?f=arguments.callee.cache[c]:(f=a.apply(this,arguments),arguments.callee.cache[c]=f);return f};c.cache={};return c};b.curry=function(a){var c=b.slice(arguments,1);return function(){var d=b.slice(arguments,0),d=b.concat(c,
d);return a.apply(this,d)}};e.attribute=function(){var a=e.params("attribute",arguments,{name:{pos:0,req:!0},def:{pos:1,req:!0},validate:{pos:2,def:null}});return b.proxy({value:a.def},function(c,d){var f=this.value;if(0<arguments.length){var e=!0;if(null!==a.validate)if("string"===typeof a.validate||"boolean"===typeof a.validate||"number"===typeof a.validate)e=c===a.validate;else if("object"===typeof a.validate&&a.validate instanceof RegExp)e=a.validate.test(c);else if("function"===typeof a.validate)e=
a.validate(c,f,d,a.name);else throw b.exception("attribute",'validation value "'+a.validate+'" for attribute "'+a.name+'" is of unsupported type "'+typeof a.validate+'"');if("undefined"!==typeof d&&d)return e;if(e)this.value=c,e=this.__this__,"undefined"!==typeof e&&"function"===typeof e.notify&&e.notify.call(e,"attribute:set:"+a.name,c,f,a.name);else throw b.exception("attribute",'invalid value "'+c+'" for attribute "'+a.name+'"');}return f},!0)};b.hooks={};b.hook_proc={none:{init:void 0,step:function(){}},
pass:{init:function(a){return a[0]},step:function(a,b){return b}},or:{init:!1,step:function(a,b){return a||b}},and:{init:!0,step:function(a,b){return a&&b}},mult:{init:1,step:function(a,b){return a*b}},add:{init:0,step:function(a,b){return a+b}},append:{init:"",step:function(a,b){return a+b}},push:{init:[],step:function(a,b){a.push(b);return a}},concat:{init:[],step:function(a,c){return b.concat(a,c)}},insert:{init:{},step:function(a,b){a[b]=!0;return a}},extend:{init:{},step:function(a,c){return b.extend(a,
c)}}};b.latch=function(a,c){if(2>arguments.length)throw b.exception("latch(internal)","missing arguments");"undefined"===typeof b.hooks[a]&&(b.hooks[a]=[]);var d=b.slice(arguments,2),f=b.cid();b.hooks[a].push({id:f,cb:c,args:d});return f};b.unlatch=function(a,c){if(2!==arguments.length)throw b.exception("unlatch(internal)","invalid number of arguments");if("undefined"===typeof b.hooks[a])throw b.exception("unlatch(internal)","no such hook");for(var d=-1,f=0;f<b.hooks[a].length;f++)if(b.hooks[a][f].id===
c){d=f;break}if(-1===d)throw b.exception("unlatch(internal)","no such latched callback");b.hooks[a]=b.hooks[a].splice(d,1)};b.hook=function(a,c){if(2>arguments.length)throw b.exception("hook(internal)","missing argument");if("undefined"===typeof b.hook_proc[c])throw b.exception("hook(internal)","no such result processing defined");var d=b.hook_proc[c].init,f=null;"function"===typeof d&&(f=b.slice(arguments,2),d=d.call(null,f));"undefined"!==typeof b.hooks[a]&&(null===f&&(f=b.slice(arguments,2)),b.foreach(b.hooks[a],
function(g){g=g.cb.apply({args:g.args,result:d,hooks:b.hooks[a].length,_cs:b,$cs:e},f);d=b.hook_proc[c].step.call(null,d,g)}));return d};b.clazz_or_trait=function(a,c){var d=function(){var a=arguments.callee,c=arguments;if(!(this instanceof a))return new a;(function(a,c,d,f){var e=b.annotation(c,"extend");null!==e&&arguments.callee(a,e,d,!1);e=b.annotation(c,"mixin");if(null!==e)for(var g=0;g<e.length;g++)arguments.callee(a,e[g],d,!0);e=b.annotation(c,"dynamics");if(null!==e)for(var h in e)b.isown(e,
h)&&("null"!==b.istypeof(e[h])&&"function"===b.istypeof(e[h].clone)?a[h]=e[h].clone():a[h]=b.clone(e[h]));f&&(h=b.annotation(c,"cons"),null!==h&&("clazz"===b.istypeof(c)?h.apply(a,d):h.call(a)))})(this,a,c,!0)},f=function(a){return!a.match("^(?:base|__ComponentJS_[A-Za-z]+__)$")};if(b.isdefined(a.extend)){b.extend(d,a.extend,f);var g=function(){this.constructor=d};g.prototype=a.extend.prototype;d.prototype=new g;b.annotation(d,"extend",a.extend)}if(b.isdefined(a.mixin)){for(g=0;g<a.mixin.length;g++)b.extend(d,
a.mixin[g],f),b.mixin(d.prototype,a.mixin[g].prototype,f);b.annotation(d,"mixin",a.mixin)}f=e.nop;b.isdefined(a.cons)?f=a.cons:b.isdefined(a.extend)&&(f=function(){this.base()});b.annotation(d,"cons",f);b.annotation(f,"name","cons");b.isdefined(a.extend)&&b.annotation(f,"base",b.annotation(a.extend,"cons"));b.isdefined(a.setup)&&b.annotation(d,"setup",a.setup);b.isdefined(a.statics)&&b.extend(d,a.statics);b.isdefined(a.protos)&&b.mixin(d.prototype,a.protos);b.isdefined(a.dynamics)&&b.annotation(d,
"dynamics",a.dynamics);var k=function(a,c){for(var d=b.annotation(a,c);null===d&&!0===b.annotation(a.caller,"clone");)d=b.annotation(a.caller,c),a=a.caller;return d};d.prototype.base=function(){var a=k(arguments.callee.caller,"name"),c=k(arguments.callee.caller,"base"),d=b.annotation(this.constructor,"extend");if("function"===b.istypeof(c))return c.apply(this,arguments);if("string"===b.istypeof(a)&&"clazz"===b.istypeof(d)&&"function"===b.istypeof(d[a]))return d[a].apply(this,arguments);if("string"===
b.istypeof(a)&&"clazz"===b.istypeof(d)&&"object"===b.istypeof(d.prototype)&&"function"===b.istypeof(d.prototype[a]))return d.prototype[a].apply(this,arguments);throw b.exception("base",'no base method found for method "'+a+'" in inheritance/mixin chain');};c&&function(a,c){if("array"===b.istypeof(b.annotation(c,"mixin")))for(var d=b.annotation(c,"mixin"),e=0;e<d.length;e++)arguments.callee(a,d[e]);"function"===b.istypeof(b.annotation(c,"setup"))&&b.annotation(c,"setup").call(a)}(d,d);"string"===typeof a.name&&
e.ns(a.name,d);return d};e.clazz=function(){var a=e.params("clazz",arguments,{name:{def:void 0,valid:"string"},extend:{def:void 0,valid:"clazz"},mixin:{def:void 0,valid:"[trait*]"},cons:{def:void 0,valid:"function"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"object"},statics:{def:void 0,valid:"object"}}),a=b.clazz_or_trait(a,!0);b.annotation(a,"type","clazz");return a};e.trait=function(){var a=e.params("trait",arguments,{name:{def:void 0,valid:"string"},mixin:{def:void 0,valid:"[trait*]"},
cons:{def:void 0,valid:"function"},setup:{def:void 0,valid:"function"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"object"},statics:{def:void 0,valid:"object"}}),a=b.clazz_or_trait(a,!1);b.annotation(a,"type","trait");return a};e.pattern.id=e.trait({dynamics:{id:e.attribute("id",null)}});e.pattern.name=e.trait({dynamics:{name:e.attribute("name","")}});e.pattern.tree=e.trait({mixin:[e.pattern.name],dynamics:{parent:e.attribute("parent",null),children:e.attribute("children",[])},
protos:{path:function(a){var b,d;if("undefined"===typeof a)for(b=[],d=this;null!==d;d=d.parent())b.push(d);else if(b="",null===this.parent())b=a;else for(d=this;null!==d.parent();d=d.parent())b=a+d.name()+b;return b},attach:function(a){null!==this.parent()&&this.detach();var b=a.children();b.push(this);a.children(b);this.parent(a)},detach:function(){if(null!==this.parent()){var a=this;this.parent().children(b.filter(this.parent().children(),function(b){return b!==a}));this.parent(null)}},walk_up:function(a,
b){var d,e;d=0;for(e=this;null!==e;e=e.parent(),d++)b=a(d,e,b);return b},walk_down:function(a,b){var d=function(b,c,e){"function"===typeof a&&(e=a(b,c,e,!1));for(var h=c.children(),l=0;l<h.length;l++)e=d(b+1,h[l],e);"function"===typeof a&&(e=a(b,c,e,!0));return e};return b=d(0,this,b)},_tree_dump:function(a){return this.walk_down(function(b,d,e,g){if(!g){for(g=0;g<b;g++)e+="    ";e+='"'+d.name()+'"';"function"===typeof a&&(e+=": "+a(d));e+="\n"}return e},"")}}});e.pattern.config=e.trait({dynamics:{__config:{}},
protos:{cfg:function(a,c){var d;if(0===arguments.length){d=[];for(var e in this.__config)b.isown(this.__config,e)&&d.push(e)}else if(1===arguments.length&&"string"===typeof a)d=this.__config[a];else if(2===arguments.length&&null!==c)d=this.__config[a],this.__config[a]=c;else if(2===arguments.length)d=this.__config[a],delete this.__config[a];else throw b.exception("cfg","invalid arguments");return d}}});e.pattern.spool=e.trait({dynamics:{__spool:{}},protos:{spool:function(){var a=e.params("spool",
arguments,{name:{pos:0,req:!0},ctx:{pos:1,req:!0},func:{pos:2,req:!0},args:{pos:"...",def:[]}});if(!b.istypeof(a.func).match(/^(string|function)$/))throw b.exception("spool","invalid function parameter (neither function object nor method name)");if("string"===b.istypeof(a.func)){if("function"!==b.istypeof(a.ctx[a.func]))throw b.exception("spool",'invalid method name: "'+a.func+'"');a.func=a.ctx[a.func]}b.isdefined(this.__spool[a.name])||(this.__spool[a.name]=[]);this.__spool[a.name].push(a)},spooled:function(){var a=
e.params("spooled",arguments,{name:{pos:0,req:!0}});return b.isdefined(this.__spool[a.name])?this.__spool[a.name].length:0},unspool:function(){var a=e.params("unspool",arguments,{name:{pos:0,req:!0}}),c=this.__spool[a.name];if(!b.isdefined(c))throw b.exception("unspool",'no such spool: "'+a.name+'"');for(var d=c.length-1;0<=d;d--)c[d].func.apply(c[d].ctx,c[d].args);delete this.__spool[a.name]}}});b.spool_spec_parse=function(a,b){var d={};d.comp=a;d.name=b;var f=d.name.match(/^([^:]+):(.+)$/);null!==
f&&(d.comp=e(a,f[1]),d.name=f[2]);return d};e.pattern.property=e.trait({mixin:[e.pattern.tree,e.pattern.config],protos:{property:function(){var a=e.params("property",arguments,{name:{pos:0,req:!0},value:{pos:1,def:void 0},scope:{def:void 0},bubbling:{def:!0},targeting:{def:!0},returnowner:{def:!1}});if(!a.targeting&&!a.bubbling)throw b.exception("property","disabling both targeting and bubbling makes no sense");var c;c=void 0;for(var d,f=[],g=this;null!==g;f.unshift(g.name()),g=g.parent())if(0!==
f.length||a.targeting){if(0<f.length){for(var k=f.length-1;0<=k&&(d=f.slice(0,k+1).join("/"),d=g.cfg("ComponentJS:property:"+a.name+"@"+d),"undefined"===typeof d);k--);if("undefined"!==typeof d){c=a.returnowner?g:d;break}}d=g.cfg("ComponentJS:property:"+a.name);if("undefined"!==typeof d){c=a.returnowner?g:d;break}if(!a.bubbling)break}"undefined"!==typeof a.value&&("undefined"!==typeof a.scope?this.cfg("ComponentJS:property:"+a.name+"@"+a.scope,a.value):this.cfg("ComponentJS:property:"+a.name,a.value));
return c}}});e.pattern.spec=e.trait({mixin:[e.pattern.name],dynamics:{__spec:{}},protos:{spec:function(){var a=this.__spec;if(0===arguments.length)return a;if(1===arguments.length&&"string"===typeof arguments[0])return a[arguments[0]];for(var c=0;c<arguments.length;c++)if("string"===typeof arguments[c])a[arguments[c]]=arguments[c+1],c++;else if("object"===typeof arguments[c])for(var d in arguments[c])b.isown(arguments[c],d)&&(a[d]=arguments[c][d])},matches:function(a,c){if("string"===typeof a){if(this.name()!==
a)return!1}else if("object"===typeof a&&a instanceof RegExp){if(!this.name().match(a))return!1}else throw b.exception("matches","invalid name pattern");var d=this.__spec,e;for(e in c)if(b.isown(c,e)){if(!b.isdefined(d[e]))return!1;var g=c[e];switch(typeof d[e]){case "number":case "boolean":if(d[e]!==g)return!1;break;case "string":if(!("string"===typeof g&&d[e]===g||"object"===typeof g&&g instanceof RegExp&&!d[e].match(g)))return!1}}return!0}}});e.pattern.observable=e.trait({dynamics:{__listener:{}},
protos:{listen:function(){var a=e.params("listen",arguments,{name:{pos:0,req:!0},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},spec:{def:null}}),c=b.cid();this.__listener[c]=a;return c},listening:function(){var a=e.params("listening",arguments,{id:{pos:0,req:!0}});return"undefined"!==typeof this.__listener[a.id]},unlisten:function(){var a=e.params("unlisten",arguments,{id:{pos:0,req:!0}});if("undefined"===typeof this.__listener[a.id])throw b.exception("unlisten","listener not found");
var c=this.__listener[a.id];delete this.__listener[a.id];return c},notify:function(){var a=e.params("notify",arguments,{name:{pos:0,req:!0},args:{pos:"...",def:[]},matches:{def:function(a,b){return a.name===b.name}}}),c;for(c in this.__listener)if(b.isown(this.__listener,c)){var d=this.__listener[c];if(a.matches(a,d)){var f=b.concat(d.args,a.args);d.func.apply(d.ctx,f)}}}}});e.pattern.event=e.clazz({mixin:[e.pattern.spec],dynamics:{target:e.attribute("target",null),propagation:e.attribute("propagation",
!0),processing:e.attribute("processing",!0),dispatched:e.attribute("dispatched",!1),decline:e.attribute("decline",!1),state:e.attribute("state","targeting"),result:e.attribute("result",void 0),async:e.attribute("async",!1)}});e.event=function(){var a=e.params("event",arguments,{name:{pos:0,req:!0},spec:{def:{}},target:{pos:1,req:!0},propagation:{pos:2,def:!0},processing:{pos:3,def:!0},dispatched:{pos:4,def:!1},decline:{pos:5,def:!1},state:{pos:6,def:"targeting"},result:{pos:7,def:void 0},async:{pos:8,
def:!1}}),b=new e.pattern.event;b.name(a.name);b.target(a.target);b.propagation(a.propagation);b.processing(a.processing);b.dispatched(a.dispatched);b.decline(a.decline);b.state(a.state);b.result(a.result);b.spec(a.spec);b.async(a.async);return b};e.pattern.eventing=e.trait({dynamics:{__subscription:{}},protos:{subscribe:function(){var a=e.params("subscribe",arguments,{name:{pos:0,req:!0},spec:{def:{}},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},capturing:{def:!1},spreading:{def:!1},
bubbling:{def:!0},noevent:{def:!1},exclusive:{def:!1},spool:{def:null}}),c=this._subscriptions(a.name,a.spec);if(1===c.length&&c[0].exclusive)throw b.exception("subscribe","existing exclusive subscription prevents additional one");if(a.exclusive&&0<c.length)throw b.exception("subscribe","non-exclusive subscription(s) prevent exclusive one");c=b.cid();this.__subscription[c]=a;null!==a.spool&&(a=b.spool_spec_parse(this,a.spool),a.comp.spool(a.name,this,"unsubscribe",c));return c},unsubscribe:function(){var a=
e.params("unsubscribe",arguments,{id:{pos:0,req:!0}});if("undefined"===typeof this.__subscription[a.id])throw b.exception("unsubscribe","subscription not found");delete this.__subscription[a.id]},subscription:function(){var a=e.params("subscription",arguments,{id:{pos:0,req:!0}});return"undefined"!==typeof this.__subscription[a.id]},_subscriptions:function(){var a=e.params("subscriptions",arguments,{name:{pos:0,req:!0},spec:{pos:1,def:{}}}),a=e.event({name:a.name,spec:a.spec,target:e.nop}),c=[],d;
for(d in this.__subscription)if(b.isown(this.__subscription,d)){var f=this.__subscription[d];a.matches(f.name,f.spec)&&c.push(f)}return c},publish:function(){var a,c=this,d=e.params("publish",arguments,{name:{pos:0,req:!0},spec:{def:{}},async:{def:!1},capturing:{def:!0},spreading:{def:!1},bubbling:{def:!0},completed:{def:e.nop},resultinit:{def:void 0},resultstep:{def:function(a,b){return b}},directresult:{def:!1},noresult:{def:!1},firstonly:{def:!1},silent:{def:!1},args:{pos:"...",def:[]}}),f=!1;
if(!d.capturing&&!d.spreading&&!d.bubbling){var g=!1,k;for(k in this.__subscription)if(b.isown(this.__subscription,k)){g=!0;break}if(!g){if(d.noresult)return;if(d.directresult)return d.resultinit;f=!0}}var h=e.event({name:d.name,spec:d.spec,async:d.async,result:d.resultinit,target:c,propagation:!0,processing:!0,dispatched:!1});if(f)return h;d.silent||e.debug(1,"event: "+h.target().path("/")+": publish: name="+h.name()+" async="+h.async()+" capturing="+d.capturing+" spreading="+d.spreading+" bubbling="+
d.bubbling+" directresult="+d.directresult+" noresult="+d.noresult+" firstonly="+d.firstonly);var l=function(a,c,d,f){for(var g in c.__subscription)if(b.isown(c.__subscription,g)){var h=c.__subscription[g];if(("capturing"===f&&h.capturing||"targeting"===f||"spreading"===f&&h.spreading||"bubbling"===f&&h.bubbling)&&a.matches(h.name,h.spec)){d.silent||e.debug(1,"event: "+c.path("/")+": dispatch on "+f);a.state(f);a.decline(!1);var k=b.concat(h.noevent?[]:[a],h.args,d.args),k=h.func.apply(h.ctx,k);h.noevent&&
b.isdefined(k)&&a.result(d.resultstep(a.result(),k));a.decline()||(a.dispatched(!0),d.firstonly&&a.propagation(!1))}}},m=function(b,c,d){var e;if(d.capturing||d.bubbling)e=c.path();if(d.capturing)for(a=e.length-1;1<=a&&(l(b,e[a],d,"capturing"),b.propagation());a--);b.propagation()&&l(b,c,d,"targeting");if(d.spreading&&b.propagation()){var f=function(a,c){var e=!0;c||(l(b,a,d,"spreading"),b.propagation()||(b.propagation(!0),e=!1));if(e)for(var e=a.children(),g=0;g<e.length;g++)f(e[g],!1)};f(c,!0)}if(d.bubbling&&
b.propagation())for(a=1;a<e.length&&(l(b,e[a],d,"bubbling"),b.propagation());a++);d.completed.call(c,b)};h.async()?setTimeout(b.hook("ComponentJS:settimeout:func","pass",function(){m(h,c,d)}),0):m(h,c,d);if(!d.noresult)return d.directresult?h.result():h}}});e.pattern.command=e.clazz({mixin:[e.pattern.observable],dynamics:{ctx:e.attribute("ctx",null),func:e.attribute("func",e.nop),args:e.attribute("args",[]),async:e.attribute("async",!1),enabled:e.attribute({name:"enabled",def:!0,validate:function(a){return"boolean"===
typeof a}})},protos:{execute:function(a,c){if(this.enabled()){var d=[];this.async()&&d.push(function(a){"function"===typeof c&&c(a)});d=b.concat(d,this.args(),a);return this.func().apply(this.ctx(),d)}}}});e.command=function(){var a=e.params("command",arguments,{ctx:{def:null},func:{pos:0,req:!0},args:{pos:"...",def:[]},async:{def:!1},enabled:{def:!0},wrap:{def:!1}}),c=new e.pattern.command;c.ctx(a.ctx);c.func(a.func);c.args(a.args);c.async(a.async);c.enabled(a.enabled);var d=c;a.wrap&&(d=function(){var a=
b.concat(arguments),c=null;arguments.callee.command.async()&&(c=a.pop());return arguments.callee.command.execute.call(arguments.callee.command,a,c)},d.command=c);return d};b.states=[{enter:null,leave:null,state:"dead",color:"#000000"}];b.states_clear=function(){b.states=b.slice(b.states,0,1)};b.states_add=function(a,c,d,e,g){a={enter:c,leave:d,state:a,color:e};for(c=1;c<b.states.length&&(null===g||b.states[c].state!==g);)c++;b.states.splice(c,0,a)};b.state_name2idx=function(a){var c=-1,d;for(d=0;d<
b.states.length;d++)if(b.states[d].state===a){c=d;break}return c};b.state_method_call=function(a,c,d){var e=!0,g=c.obj();null!==g&&"function"===typeof g[d]&&(a={type:a,comp:c,method:d,ctx:g,func:g[d]},b.hook("ComponentJS:state-method-call","none",a),e=a.func.call(a.ctx));return e};b.state_requests={};b.state_progression=function(){setTimeout(b.hook("ComponentJS:settimeout:func","pass",function(){var a=[],c;for(c in b.state_requests)b.isown(b.state_requests,c)&&b.state_progression_single(b.state_requests[c])&&
a.push(c);b.foreach(a,function(a){delete b.state_requests[a]});b.hook("ComponentJS:state-change","none")}),0)};b.state_progression_single=function(a){var c=!1;b.state_progression_run(a.comp,a.state);b.states[a.comp.__state].state===a.state&&("function"===typeof a.callback&&a.callback.call(a.comp,a.state),c=!0);return c};b.state_progression_run=function(a,c,d){var f,g,k,h;"undefined"===typeof d&&(d="upward-and-downward");var l=b.state_name2idx(c);if(-1===l)throw b.exception("state",'invalid argument "'+
c+'"');if(a.__state<l)for(;a.__state<l;){c=b.states[a.__state+1].state;k=b.states[a.__state+1].enter;if(null!==a.parent()&&0>a.parent().state_compare(c)&&(b.state_progression_run(a.parent(),c,"upward"),0>a.parent().state_compare(c))){e.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY PARENT COMPONENT ("+a.parent().path("/")+"): @"+b.states[a.__state].state+" --("+k+")--\x3e @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");break}if(b.isdefined(a.__state_guards[k])){e.debug(1,
"state: "+a.path("/")+": transition (increase) REJECTED BY ENTER GUARD: @"+b.states[a.__state].state+" --("+k+")--\x3e @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");break}a.__state++;e.debug(1,"state: "+a.path("/")+": transition (increase): @"+b.states[a.__state-1].state+" --("+k+")--\x3e @"+b.states[a.__state].state);b.hook("ComponentJS:state-invalidate","none","states");b.hook("ComponentJS:state-change","none");if(!1===b.state_method_call("enter",a,k)){e.debug(1,"state: "+
a.path("/")+": transition (increase) REJECTED BY ENTER METHOD: @"+b.states[a.__state-1].state+" --("+k+")--\x3e @"+b.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");a.__state--;break}a.publish({name:"ComponentJS:state:"+b.states[a.__state].state,noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0});if("upward-and-downward"===d||"downward"===d)for(g=a.children(),f=0;f<g.length;f++)0>g[f].state_compare(c)&&(g[f].state_auto_increase()||!0===g[f].property("ComponentJS:state-auto-increase"))&&
(b.state_progression_run(g[f],c,"downward"),0>g[f].state_compare(c)&&(b.state_requests[g[f].id()]={comp:g[f],state:c},b.hook("ComponentJS:state-invalidate","none","requests"),b.hook("ComponentJS:state-change","none")))}else if(a.__state>l)for(;a.__state>l;){c=b.states[a.__state].state;h=b.states[a.__state].leave;k=b.states[a.__state-1].state;g=a.children();for(f=0;f<g.length;f++)if(0<g[f].state_compare(k)&&(b.state_progression_run(g[f],k,"downward"),0<g[f].state_compare(k))){e.debug(1,"state: "+a.path("/")+
": transition (decrease) REJECTED BY CHILD COMPONENT ("+g[f].path("/")+"): @"+b.states[a.__state-1].state+" <--("+h+")-- @"+b.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");return}if(b.isdefined(a.__state_guards[h])){e.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE GUARD: @"+b.states[a.__state-1].state+" <--("+h+")-- @"+b.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");break}a.__state--;e.debug(1,"state: "+a.path("/")+": transition (decrease): @"+
b.states[a.__state].state+" <--("+h+")-- @"+b.states[a.__state+1].state);b.hook("ComponentJS:state-invalidate","none","states");b.hook("ComponentJS:state-change","none");if(!1===b.state_method_call("leave",a,h)){e.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE METHOD: @"+b.states[a.__state].state+" <--("+h+")-- @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");a.__state++;break}else f=a.spooled(c),0<f&&(e.debug(1,"state: "+a.path("/")+": auto-unspooling "+
f+" operation(s)"),a.unspool(c));a.publish({name:"ComponentJS:state:"+b.states[a.__state].state,noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0});("upward-and-downward"===d||"upward"===d)&&null!==a.parent()&&0<a.parent().state_compare(k)&&(a.parent().state_auto_decrease()||!0===a.parent().property("ComponentJS:state-auto-decrease"))&&(b.state_progression_run(a.parent(),k,"upward"),0<a.parent().state_compare(k)&&(b.state_requests[a.parent().id()]={comp:a.parent(),state:k},b.hook("ComponentJS:state-invalidate",
"none","requests"),b.hook("ComponentJS:state-change","none")))}};e.pattern.state=e.trait({mixin:[e.pattern.tree],dynamics:{__state:0,__state_guards:{},state_auto_increase:e.attribute("state_auto_increase",!1),state_auto_decrease:e.attribute("state_auto_decrease",!1)},protos:{state:function(){var a=b.states[this.__state].state;if(0===arguments.length)return a;var c=e.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==b.state_name2idx(a)}},callback:{pos:1,def:void 0},sync:{def:!1}});
if(b.states[this.__state].state!==c.state){var d=!0,f={comp:this,state:c.state,callback:c.callback};c.sync&&b.state_progression_single(f)&&(d=!1);d&&(b.state_requests[this.id()]=f,b.hook("ComponentJS:state-invalidate","none","requests"),b.state_progression())}else"function"===typeof c.callback&&c.callback.call(this,c.state);return a},state_compare:function(){var a=e.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==b.state_name2idx(a)}}}),a=b.state_name2idx(a.state);return this.__state-
a},guard:function(){var a=e.params("guard",arguments,{method:{pos:0,valid:"string",req:!0},level:{pos:1,valid:"number",req:!0}}),c=!1,d;for(d=0;d<b.states.length;d++)if(b.states[d].enter===a.method||b.states[d].leave===a.method){c=!0;break}if(!c)throw b.exception("guard",'no such declared enter/leave method: "'+a.method+'"');b.isdefined(this.__state_guards[a.method])||(this.__state_guards[a.method]=0);c=!1;if(0<a.level)this.__state_guards[a.method]+=a.level;else if(0>a.level){if(this.__state_guards[a.method]<
-a.level)throw b.exception("guard","guard level decrease request too large");this.__state_guards[a.method]+=a.level;0===this.__state_guards[a.method]&&(c=!0)}else this.__state_guards[a.method]=0,c=!0;c&&(delete this.__state_guards[a.method],b.state_progression())}}});e.pattern.service=e.trait({mixin:[e.pattern.eventing],protos:{register:function(){var a=e.params("register",arguments,{name:{pos:0,req:!0},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},spool:{def:null},capturing:{def:!1},
spreading:{def:!1},bubbling:{def:!0}}),c=e.command({ctx:a.ctx,func:a.func,args:a.args,wrap:!0});c.command.listen({name:"attribute:set:enabled",args:[this,a.name],func:function(a,b,c,e){a.publish({name:"ComponentJS:service:"+b+":callable",args:[c,e],capturing:!1,spreading:!1,bubbling:!1,async:!0,noresult:!0})}});c=this.subscribe({name:"ComponentJS:service:"+a.name,ctx:a.ctx,func:c,noevent:!0,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,exclusive:!0});null!==a.spool&&(a=b.spool_spec_parse(this,
a.spool),a.comp.spool(a.name,this,"unregister",c));return c},registration:function(){var a=e.params("registration",arguments,{id:{pos:0,req:!0}});return this.subscription(a.id)},unregister:function(){var a=e.params("unregister",arguments,{id:{pos:0,req:!0}});this.unsubscribe(a.id)},callable:function(){var a=e.params("callable",arguments,{name:{pos:0,req:!0},value:{pos:1,def:void 0}}),b=this._subscriptions(a.name);return 1!==b.length?void 0:b[0].func().command.enabled(a.value)},call:function(){var a=
e.params("call",arguments,{name:{pos:0,req:!0},args:{pos:"...",def:[]},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0}}),c=this.publish({name:"ComponentJS:service:"+a.name,args:a.args,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,firstonly:!0,async:!1});if(!c.dispatched())throw b.exception("call",'no such registered service found: "'+a.name+'"');return c.result()}}});e.pattern.shadow=e.trait({dynamics:{__obj:null},protos:{obj:function(a){if("undefined"===typeof a)return this.__obj;
if("object"===typeof a)null!==a?(b.annotation(a,"comp",this),this.__obj=a):(null!==this.__obj&&b.annotation(this.__obj,"comp",null),this.__obj=null);else throw b.exception("obj","invalid argument");return this},access:function(a,c){if("undefined"===typeof a)throw b.exception("access","no attribute name given");var d=this.obj();if(null===d)throw b.exception("access","still no object attached");if("undefined"===typeof d[a])throw b.exception("access",'invalid attribute "'+a+'"');var e=d[a];"undefined"!==
typeof c&&(d[a]=c);return e},invoke:function(a){if("undefined"===typeof a)throw b.exception("invoke","no method name given");var c=this.obj();if(null===c)throw b.exception("invoke","still no object attached");if("undefined"===typeof c[a])throw b.exception("invoke",'invalid method "'+a+'"');if("function"!==b.istypeof(c[a]))throw b.exception("invoke",'anything named "'+a+'" existing, but not a function');var d=b.slice(arguments,1);return c[a].apply(c,d)}}});e.pattern.socket=e.trait({mixin:[e.pattern.tree,
e.pattern.property],dynamics:{__sockets:{},__plugs:{}},protos:{socket:function(){var a=e.params("socket",arguments,{name:{def:"default"},scope:{def:null},ctx:{pos:0,req:!0},plug:{pos:1,req:!0},unplug:{pos:2,req:!0},spool:{def:null}});if("string"===b.istypeof(a.plug)&&"function"!==b.istypeof(a.ctx[a.plug]))throw b.exception("socket",'no plug method named "'+a.plug+'" found on context object');if("string"!==b.istypeof(a.plug)&&"function"!==b.istypeof(a.plug))throw b.exception("socket","plug operation neither method name nor function");
if("string"===b.istypeof(a.unplug)&&"function"!==b.istypeof(a.ctx[a.unplug]))throw b.exception("socket",'no unplug method named "'+a.unplug+'" found on context object');if("string"!==b.istypeof(a.unplug)&&"function"!==b.istypeof(a.unplug))throw b.exception("socket","unplug operation neither method name nor function");var c="ComponentJS:socket:"+a.name;null!==a.scope&&(c+="@"+a.scope);e(this).property(c,a);var d=b.cid();this.__sockets[d]=c;null!==a.spool&&(a=b.spool_spec_parse(this,a.spool),a.comp.spool(a.name,
this,"unsocket",d));return d},unsocket:function(){var a=e.params("unsocket",arguments,{id:{pos:0,req:!0}});if("undefined"===typeof this.__sockets[a.id])throw b.exception("unsocket","socket not found");var c=this.__sockets[a.id];e(this).property(c,null);delete this.__sockets[a.id]},link:function(){var a=e.params("link",arguments,{name:{def:"default"},scope:{def:null},target:{pos:0,req:!0},socket:{pos:1,req:!0},spool:{def:null}});return this.socket({name:a.name,scope:a.scope,spool:a.spool,ctx:{},plug:function(c){var d=
b.annotation(c,"link");if(null!==d)throw b.exception("link:plug: cannot plug, you have to unplug first");d=e(a.target).plug({name:a.socket,object:c,targeting:!0});b.annotation(c,"link",d)},unplug:function(c){var d=b.annotation(c,"link");if(null===d)throw b.exception("link:unplug: cannot unplug, you have to plug first");e(a.target).unplug({id:d,targeting:!0});b.annotation(c,"link",null)}})},unlink:function(){var a=e.params("unlink",arguments,{id:{pos:0,req:!0}});return this.unsocket(a.id)},plug:function(){var a=
e.params("plug",arguments,{name:{def:"default"},object:{pos:0,req:!0},spool:{def:null},targeting:{def:!1}}),c=b.cid();this.__plugs[c]=a;b.plugger("plug",this,a.name,a.object,a.targeting);null!==a.spool&&(a=b.spool_spec_parse(this,a.spool),a.comp.spool(a.name,this,"unplug",c));return c},unplug:function(){var a=e.params("unplug",arguments,{id:{pos:0,req:!0},targeting:{def:!1}});if("undefined"===typeof this.__plugs[a.id])throw b.exception("unplug","plugging not found");b.plugger("unplug",this,this.__plugs[a.id].name,
this.__plugs[a.id].object,a.targeting);delete this.__plugs[a.id]}}});b.plugger=function(a,c,d,f,g){var k="ComponentJS:socket:"+d,h=c.property({name:k,targeting:g});if(!b.isdefined(h))throw b.exception(a,"no socket found on parent component(s)");g=c.property({name:k,targeting:g,returnowner:!0});e.debug(1,"socket: "+g.path("/")+": "+d+" <--("+a+")-- "+c.path("/"));if("string"===b.istypeof(h[a]))h.ctx[h[a]].call(h.ctx,f,c);else if("function"===b.istypeof(h[a]))h[a].call(h.ctx,f,c);else throw b.exception(a,
'failed to perform "'+a+'" operation');};e.mark=function(a,c){var d=b.annotation(a,"marker");null===d&&(d={});d[c]=!0;b.annotation(a,"marker",d)};e.marked=function(a,c){var d=b.annotation(a,"marker");null===d&&(d={});return!0===d[c]};e.pattern.marker=e.trait({protos:{mark:function(a){e.mark(this.obj(),a)},marked:function(a){return e.marked(this.obj(),a)}}});e.marker={service:e.trait({cons:function(){e.mark(this,"service")}}),controller:e.trait({cons:function(){e.mark(this,"controller")}}),model:e.trait({cons:function(){e.mark(this,
"model")}}),view:e.trait({cons:function(){e.mark(this,"view")}})};b.store_load=function(a){null===a.__store&&(b.hook("ComponentJS:store-load","none",a),null===a.__store||"object"!==typeof a.__store)&&(a.__store={})};b.store_save=function(a){null!==a.__store&&b.hook("ComponentJS:store-save","none",a)};e.pattern.store=e.trait({dynamics:{__store:null},protos:{store:function(){var a,c;if(0===arguments.length){b.store_load(this);c=[];for(a in this.__store)c.push(a);return c}if(1===arguments.length&&null===
arguments[0])return this.__store={},b.store_save(this),null;if(1===arguments.length&&"string"===typeof arguments[0])return b.store_load(this),a=arguments[0],"undefined"===typeof this.__store[a]?null:this.__store[a];if(2===arguments.length&&null===arguments[1])return b.store_load(this),a=arguments[0],delete this.__store[a],b.store_save(this),null;if(2===arguments.length)return b.store_load(this),a=arguments[0],c=arguments[1],this.__store[a]=c,b.store_save(this),c;throw b.exception("store","invalid argument(s)");
}}});e.pattern.model=e.trait({protos:{model:function(){var a=e.params("model",arguments,{model:{pos:0,def:null}}).model;null===a&&(a=void 0);var c;if(b.isdefined(a))for(c in a){"undefined"===typeof a[c].value&&(a[c].value="");"undefined"===typeof a[c].valid&&(a[c].valid="string");"undefined"===typeof a[c].autoreset&&(a[c].autoreset=!1);"undefined"===typeof a[c].store&&(a[c].store=!1);for(var d in a[c])if("value"!==d&&"valid"!==d&&"autoreset"!==d&&"store"!==d)throw b.exception("model",'invalid specification key "'+
d+'" in specification of model field "'+c+'"');if(!e.validate(a[c].value,a[c].valid))throw b.exception("model",'model field "'+c+'" has default value '+b.json(a[c].value)+', which does not validate against validation "'+a[c].valid+'"');}var f=this.store("model");if(null!==f&&b.isdefined(a))for(c in a)a[c].store&&b.isdefined(f[c])&&(a[c].value=f[c]);d=this.property({name:"ComponentJS:model",bubbling:!1});if(b.isdefined(a)){b.isdefined(d)?(f={},b.extend(f,d),b.extend(f,a),this.property("ComponentJS:model",
f),a=f):this.property("ComponentJS:model",a);var f={},g=!1;for(c in a)a[c].store&&(f[c]=a[c].value,g=!0);g&&this.store("model",f)}return d},value:function(){for(var a=e.params("value",arguments,{name:{pos:0,req:!0},value:{pos:1,def:void 0},force:{pos:2,def:!1},returnowner:{def:!1}}),c=null,d=null,f=this;null!==f;){c=f.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("value",'no model found containing value "'+a.name+'"');d=c.property("ComponentJS:model");if(b.isdefined(d[a.name]))break;
f=c.parent()}if(null===f)throw b.exception("value",'no model found containing value "'+a.name+'"');var f=a.value,g,k=d[a.name].value;"undefined"===typeof f&&!0===c.property({name:"ComponentJS:model:subscribers:get",bubbling:!1})&&(g=c.publish({name:"ComponentJS:model:"+a.name+":get",args:[k],capturing:!1,spreading:!1,bubbling:!1,async:!1}),g.processing()&&(k=d[a.name].value,g=g.result(),"undefined"!==typeof g&&(k=g)));if("undefined"!==typeof f&&(a.force||k!==f)){if(!e.validate(f,d[a.name].valid))throw b.exception("value",
'model field "'+a.name+'" receives new value '+b.json(f)+', which does not validate against validation "'+d[a.name].valid+'"');var h=!0;!0===c.property({name:"ComponentJS:model:subscribers:set",bubbling:!1})&&(g=c.publish({name:"ComponentJS:model:"+a.name+":set",args:[f,k],capturing:!1,spreading:!1,bubbling:!1,async:!1}),g.processing()?(g=g.result(),"undefined"!==typeof g&&(f=g)):h=!1);h&&!d[a.name].autoreset&&(d[a.name].value=f,d[a.name].store&&(h=c.store("model"),h[a.name]=d[a.name].value,c.store("model",
h)),!0===c.property({name:"ComponentJS:model:subscribers:changed",bubbling:!1})&&c.publish({name:"ComponentJS:model:"+a.name+":changed",args:[f,k],noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0}))}return a.returnowner?c:k},touch:function(){var a=e.params("touch",arguments,{name:{pos:0,req:!0}});this.value({name:a.name,value:this.value(a.name),force:!0})},observe:function(){for(var a=e.params("observe",arguments,{name:{pos:0,req:!0},func:{pos:1,req:!0},touch:{def:!1},operation:{def:"set"},
spool:{def:null}}),c=null,d=null,f=this;null!==f;){c=f.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("observe",'no model found containing value "'+a.name+'"');d=c.property("ComponentJS:model");if(b.isdefined(d[a.name]))break;f=c.parent()}if(null===f)throw b.exception("observe",'no model found containing value "'+a.name+'"');d=c.subscribe({name:"ComponentJS:model:"+a.name+":"+a.operation,capturing:!1,spreading:!1,bubbling:!1,func:a.func});c.property("ComponentJS:model:subscribers:"+
a.operation,!0);null!==a.spool&&(c=b.spool_spec_parse(this,a.spool),c.comp.spool(c.name,this,"unobserve",d));a.touch&&this.touch(a.name);return d},unobserve:function(){for(var a=e.params("unobserve",arguments,{id:{pos:0,req:!0}}),c=null,d=this;null!==d;){c=d.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("unobserve","no model subscription found");if(c.subscription(a.id))break;d=c.parent()}if(null===d)throw b.exception("unobserve","no model subscription found");
c.unsubscribe(a.id)}}});b.comp=null;b.none=null;b.root=null;b.comp_mixins=[e.pattern.id,e.pattern.name,e.pattern.tree,e.pattern.config,e.pattern.spool,e.pattern.state,e.pattern.service,e.pattern.eventing,e.pattern.property,e.pattern.shadow,e.pattern.socket,e.pattern.model,e.pattern.store,e.pattern.marker];b.comp_cons=function(a,c,d){b.annotation(this,"type","component");"string"!==b.istypeof(a)&&(a="<unknown>");this.name(a);this.parent("object"===b.istypeof(c)?c:null);this.children("array"===b.istypeof(d)?
d:[])};b.comp_protos={create:function(){return e.create.apply(this,b.concat([this],arguments))},destroy:function(){return e.destroy.apply(this,b.concat([this],arguments))},exists:function(){return"<none>"!==this.name()}};b.bootstrapped=!1;e.bootstrap=function(){if(b.bootstrapped)throw b.exception("bootstrap","library already bootstrapped");b.hook("ComponentJS:bootstrap:comp:mixin","none",b.comp_mixins);b.hook("ComponentJS:bootstrap:comp:protos","none",b.comp_protos);b.comp=e.clazz({mixin:b.comp_mixins,
cons:b.comp_cons,protos:b.comp_protos});b.root=new b.comp("<root>",null,[]);b.none=new b.comp("<none>",null,[]);b.foreach("call callable create destroy guard hook invoke latch link model observe plug property publish register registration socket spool spooled state state_compare store subscribe subscription touch unlatch unobserve unplug unregister unspool unsubscribe value".split(" "),function(a){b.none[a]=function(){throw b.exception(a,'no such component (you are calling method "'+a+'" on component "<none>")');
}});b.hook("ComponentJS:bootstrap","none");b.bootstrapped=!0};e.shutdown=function(){if(!b.bootstrapped)throw b.exception("shutdown","library still not bootstrapped");b.hook("ComponentJS:shutdown","none");b.none=null;b.root.destroy();b.root=null;b.comp=null;b.bootstrapped=!1};b.lookup=function(a,c){1===arguments.length&&("string"===b.istypeof(arguments[0])?(c=a,a=b.root):c="");if("string"!==typeof c)return b.none;if("<root>"===c)return b.root;if("<none>"===c)return b.none;var d;if("/"===c.substr(0,
1))d=b.root,c=c.substring(1);else{d=b.istypeof(a);var e=b.annotation(a,"comp");if("component"!==d&&null!==e)d=e;else{if("component"!==d)throw b.exception("lookup",'invalid base component (type is "'+d+'")');d=a}}if(""!==c)if(e=[],b.lookup_step(e,d,c.split("/"),0),0===e.length)d=b.none;else if(1===e.length)d=e[0];else{var g={},e=b.filter(e,function(a){a=a.id();var b="undefined"===typeof g[a];g[a]=!0;return b});if(1===e.length)d=e[0];else{for(var k="",h=0;h<e.length;h++)k+=" "+e[h].path("/");throw b.exception("lookup",
'ambiguous component path "'+c+'" at '+d.path("/")+": expected only 1 component, but found "+e.length+" components:"+k);}}return d};b.lookup_step=function(a,c,d,e){var g;if(e>=d.length)a.push(c);else if("."===d[e])b.lookup_step(a,c,d,e+1);else if(".."===d[e])null!==c.parent()&&b.lookup_step(a,c.parent(),d,e+1);else if("*"===d[e])for(g=c.children(),c=0;c<g.length;c++)b.lookup_step(a,g[c],d,e+1);else if(""===d[e])for(g=c.walk_down(function(a,b,c,d){d||c.push(b);return c},[]),c=0;c<g.length;c++)b.lookup_step(a,
g[c],d,e+1);else for(g=c.children(),c=0;c<g.length;c++)if(g[c].name()===d[e]){b.lookup_step(a,g[c],d,e+1);break}};e.create=function(){b.bootstrapped||("function"===typeof alert?alert('ComponentJS: WARNING: component system still not bootstrapped (please call "bootstrap" method before first "create" method call!)'):"undefined"!==typeof console&&"function"===typeof console.log&&console.log('ComponentJS: WARNING: component system still not bootstrapped (please call "bootstrap" method before first "create" method call!)'),
e.bootstrap());if(2>arguments.length)throw b.exception("create","invalid number of arguments");var a=0,c=null,d=null,f=[];if("string"===b.istypeof(arguments[a])){if("/"!==arguments[a].substr(0,1))throw b.exception("create",'either base component has to be given or the tree specification has to start with the root component ("/")');c=b.root}else if(d=arguments[a++],"component"!==b.istypeof(d)&&(d=b.annotation(d,"comp"),null===d))throw b.exception("create","invalid base argument (not an object attached to a component)");
for(var g=[],k=arguments[a++],h;""!==k;){h=k.match(/^\s*([^\/{},]+|[\/{},])/);if(null===h)break;g.push(h[1]);k=k.substr(h[1].length)}k=function(a,b){for(var c="",d=0;d<b&&d<a.length;d++)c+=a[d];if(d<a.length)for(c=c+"<"+a[d++],c+=">";d<a.length;d++)c+=a[d];return c};for(h=0;h<g.length;h++)if("/"===g[h]){if(null===c)throw b.exception("create","no parent component for step-down at "+k(g,h));d=c}else if("{"===g[h])f.push(d);else if(","===g[h]){if(0===f.length)throw b.exception("create","no open brace section for parallelism at "+
k(g,h));d=f[f.length-1]}else if("}"===g[h]){if(0===f.length)throw b.exception("create","no more open brace section for closing at "+k(g,h));d=f.pop();c=null}else{if(null===d)throw b.exception("create","no base component at "+k(g,h));c=b.create_single(d,g[h],arguments[a++])}if(0<f.length)throw b.exception("create","still open brace sections at end of tree specification");return c};b.create_single=function(a,c,d){if("string"!==typeof c)throw b.exception("create","invalid path argument (not a string)");
var f=c.match(/^(.*?)\/?([^\/]+)$/);if(!f[0])throw b.exception("create",'invalid path "'+c+'"');var g=f[1],f=f[2];c=b.cid();f=f.replace(/\{id\}/g,c);a=b.lookup(a,g);if(a===b.none)throw b.exception("create",'parent component path "'+g+'" not already existing (please create first)');g=b.lookup(a,f);if(g!==b.none)throw b.exception("create",'leaf component path "'+f+'" already existing (please destroy first)');var k=null;switch(b.istypeof(d)){case "clazz":case "trait":case "function":k=new d;break;case "object":k=
d;break;case "null":break;default:throw b.exception("create","invalid class argument");}g=new b.comp(f);g.id(c);g.attach(a);g.obj(k);e.debug(1,"component: "+g.path("/")+": created component ["+g.id()+"]");b.hook("ComponentJS:comp-created","none",g);g.state({state:"created",sync:!0});b.hook("ComponentJS:state-invalidate","none","components");b.hook("ComponentJS:state-change","none");return g};e.destroy=function(){if(1!==arguments.length&&2!==arguments.length)throw b.exception("destroy","invalid number of arguments");
var a=b.lookup.apply(this,arguments);if(a===b.none)throw b.exception("destroy","no such component found to destroy");if(a===b.root)throw b.exception("destroy","root component cannot be destroyed");a.state({state:"dead",sync:!0});b.hook("ComponentJS:comp-destroyed","none",a);a.detach();a.obj(null);e.debug(1,"component: "+a.path("/")+": destroyed component ["+a.id()+"]");b.hook("ComponentJS:state-invalidate","none","components");b.hook("ComponentJS:state-change","none")};e.transition=function(){if(1===
arguments.length&&null===arguments[0])b.states_clear();else{var a=e.params("transition",arguments,{target:{pos:0,req:!0},enter:{pos:1,req:!0},leave:{pos:2,req:!0},color:{pos:3,def:"#000000"},source:{def:null}});b.states_add(a.target,a.enter,a.leave,a.color,a.source)}};e.transition("created","create","destroy","#cc3333");e.transition("configured","setup","teardown","#eabc43");e.transition("prepared","prepare","cleanup","#f2ec00");e.transition("materialized","render","release","#6699cc");e.transition("visible",
"show","hide","#669933");"object"===typeof r&&"undefined"===typeof m.ComponentJS_export||"undefined"!==typeof m.ComponentJS_export&&"CommonJS"===m.ComponentJS_export?r.ComponentJS=e:"function"===typeof p&&"object"===typeof p.amd&&"undefined"===typeof m.ComponentJS_export||"undefined"!==typeof m.ComponentJS_export&&"AMD"===m.ComponentJS_export?p("ComponentJS",function(){return e}):e.symbol("ComponentJS");b.plugins={};e.plugin=function(a,c){if(0===arguments.length){var d=[];for(a in b.plugins)b.isown(b.plugins,
a)&&d.push(a);return d}if(1===arguments.length){if("string"!==typeof a)throw b.exception("plugin","invalid plugin name parameter");return"undefined"!==typeof b.plugins[a]}if(2===arguments.length){if("string"!==typeof a)throw b.exception("plugin","invalid plugin name parameter");if("undefined"!==typeof b.plugins[a])throw b.exception("plugin",'plugin named "'+a+'" already registered');c.call(this,b,e,m);b.plugins[a]=!0}else throw b.exception("plugin","invalid number of parameters");}})("undefined"!==
typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof this?this:{},"object"===typeof exports?exports:void 0,"function"===typeof define?define:void 0);
