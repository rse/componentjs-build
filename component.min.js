/*
**  ComponentJS -- Component System for JavaScript <http://componentjs.com>
**  Copyright (c) 2009-2013 Ralf S. Engelschall <http://engelschall.com>
**
**  This Source Code Form is subject to the terms of the Mozilla Public
**  License, v. 2.0. If a copy of the MPL was not distributed with this
**  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

(function(l,n,s,p){var b=function(){},e=function(){return b.lookup.apply(n,arguments)};e.pattern={};e.marker={};var u;u=void 0;var r=null;e.symbol=function(a){null!==r&&(l[r]=u);"undefined"===typeof a||""===a?r=null:(r=a,u=l[r],l[r]=e);return e};e.ns=function(a,b){if("string"!==typeof a||""===a)throw"invalid namespace path";var d=a.split("."),f=d.length;"undefined"!==typeof b&&f--;for(var e=0,h=l;e<f;)"undefined"===typeof h[d[e]]&&(h[d[e]]={}),h=h[d[e++]];"undefined"!==typeof b&&(h=h[d[e]]=b);return h};
e.version={major:0,minor:9,micro:2,date:20130208};b.exception=function(a,b){var d;0<e.debug()&&"object"===typeof l.console&&("function"===typeof l.console.trace?l.console.trace():"undefined"!==typeof l.printStackTrace&&"function"===typeof l.console.log&&(d=l.printStackTrace(),l.console.log(d.join("\n"))));return Error("[ComponentJS]: ERROR: "+a+": "+b)};b.log=function(a){b.hook("ComponentJS:log","or",a)||("undefined"!==typeof l.console&&"undefined"!==typeof l.console.log?l.console.log("[ComponentJS]: "+
a):"undefined"!==typeof l.Titanium&&("undefined"!==typeof l.Titanium.API&&"function"===typeof l.Titanium.API.log)&&l.Titanium.API.log("[ComponentJS]: "+a))};var v=9;e.debug=function(a,c){if(0===arguments.length)return v;if(1===arguments.length)v=a;else if(a<=v){for(var d="",f=1;f<a;f++)d+="    ";b.log("DEBUG["+a+"]: "+d+c)}};b.annotation=function(a,b,d){var f=null;b="__ComponentJS_"+b+"__";"undefined"!==typeof a&&null!==a&&("undefined"!==typeof a[b]&&(f=a[b]),"undefined"!==typeof d&&(null!==d?a[b]=
d:delete a[b]));return f};b.isdefined=function(a){return"undefined"!==typeof a};b.isown=function(a,b){var d=Object.hasOwnProperty.call(a,b);if("constructor"===b||"prototype"===b)d=d&&Object.propertyIsEnumerable.call(a,b),-1!==a[b].toString().indexOf("[native code]")&&(d=!1);return d};b.istypeof=function(a){var c=typeof a;"object"===c?null===a?c="null":"[object String]"===Object.prototype.toString.call(a)?c="string":"[object Number]"===Object.prototype.toString.call(a)?c="number":"[object Boolean]"===
Object.prototype.toString.call(a)?c="boolean":"[object Function]"===Object.prototype.toString.call(a)?c="function":"[object Array]"===Object.prototype.toString.call(a)?c="array":null!==b.annotation(a,"type")&&(c=b.annotation(a,"type")):"function"===c&&null!==b.annotation(a,"type")&&(c=b.annotation(a,"type"));return c};var w=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,y={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",
'"':'\\"',"\\":"\\\\"},x=function(a){w.lastIndex=0;return w.test(a)?'"'+a.replace(w,function(a){var b=y[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},z=function(a,c){if("undefined"!==typeof c[a])return"null /* [...] */";c[a]=!0;switch(typeof a){case "null":a="null";break;case "boolean":a=String(a);break;case "number":a=isFinite(a)?String(a):"null";break;case "string":a=x(a);break;case "function":a=null!==b.annotation(a,"type")?"<"+b.annotation(a,
"type")+">":"<function>";break;case "object":var d=[];if(a)if(null!==b.annotation(a,"type"))a="<"+b.annotation(a,"type")+">";else if("[object Function]"===Object.prototype.toString.call(a))a="<function>";else if("[object Array]"===Object.prototype.toString.call(a)||a instanceof Array){for(var f=0;f<a.length;f++)d[f]=arguments.callee(a[f],c);a=0===d.length?"[]":"["+d.join(",")+"]"}else{for(f in a)if(Object.hasOwnProperty.call(a,f)){var e=arguments.callee(a[f],c);d.push(x(f)+":"+e)}a=0===d.length?"{}":
"{"+d.join(",")+"}"}else a="null";break;default:a="<unknown>"}return a};b.json=function(a){return z(a,{})};b.clone=function(a,c){if("undefined"===typeof c)c=function(){return!0};else if("string"===typeof c){var d=c;c=function(a){return a.match(d)}}var f=arguments.callee,e=function(a,c){var d=function(){return a.apply(this,arguments)};d.prototype=a.prototype;for(var e in a)b.isown(a,e)&&(d[e]=c(e,a)?f(a[e],c):a[e]);b.annotation(d,"clone",!0);return d},h;h=void 0;if("function"===typeof a)h=e(a,c);else if("object"===
typeof a)if(null===a)h=null;else if("[object String]"===Object.prototype.toString.call(a))h=""+a.valueOf();else if("[object Number]"===Object.prototype.toString.call(a))h=0+a.valueOf();else if("[object Boolean]"===Object.prototype.toString.call(a))h=!!a.valueOf();else if("[object Function]"===Object.prototype.toString.call(a))h=e(a,c);else if("[object Date]"===Object.prototype.toString.call(a))h=new Date(a.getTime());else if("[object RegExp]"===Object.prototype.toString.call(a))h=RegExp(a.source);
else if("[object Array]"===Object.prototype.toString.call(a)){e=a.length;h=Array(e);for(var j=0;j<e;j++)h.push(f(a[j],c))}else{h={};for(j in a)"constructor"!==j&&b.isown(a,j)&&(h[j]=c(j,a)?f(a[j],c):a[j]);"function"===typeof a.constructor&&(h.constructor=a.constructor);"object"===typeof a.prototype&&(h.prototype=a.prototype)}else h=a;return h};b.extend=function(a,c,d){if("undefined"===typeof d)d=function(){return!0};else if("string"===typeof d){var f=d;d=function(a){return a.match(f)}}for(var e in c)b.isown(c,
e)&&d(e,c[e])&&(a[e]=c[e]);return a};b.mixin=function(a,c,d){if("undefined"===typeof d)d=function(){return!0};else if("string"===typeof d){var f=d;d=function(a){return a.match(f)}}for(var e in c)if(b.isown(c,e)&&d(e,c[e]))if("function"===b.istypeof(c[e])){var h=b.clone(c[e],d);b.annotation(h,"name",e);"function"===b.istypeof(a[e])&&b.isown(a,e)&&b.annotation(h,"base",a[e]);a[e]=h}else a[e]=c[e];return a};b.concat=function(){for(var a=[],b=0;b<arguments.length;b++)for(var d=arguments[b],f=0;f<d.length;f++)a.push(d[f]);
return a};b.slice=function(a,b,d){var f=[];"undefined"===typeof d&&(d=a.length);for(;b<d;b++)f.push(a[b]);return f};b.map=function(a,b){for(var d=[],f=0;f<a.length;f++)d.push(b(a[f],f));return d};b.filter=function(a,b){for(var d=[],f=0;f<a.length;f++)b(a[f],f)&&d.push(a[f]);return d};b.foreach=function(a,b){for(var d=0;d<a.length;d++)b(a[d],d)};e.nop=function(){};b.validate=function(){var a=e.params("validate",arguments,{value:{pos:0,req:!0},valid:{pos:1,req:!0}});if("string"===typeof a.valid){var c=
a.valid.match(/^array\((.+?)\)$/);if(c){var d=c[1];a.valid=function(a){if("array"!==b.istypeof(a))return!1;for(var c=0;c<a.length;c++)if(b.istypeof(a[c])!==d)return!1;return!0}}else{var f=a.valid;a.valid=function(a){return b.istypeof(a)===f}}}else if("object"===typeof a.valid&&a.valid instanceof RegExp){var g=a.valid;a.valid=function(a){return!!a.match(g)}}else if("function"!==typeof a.valid)throw b.exception("validate","invalid validator");return a.valid(a.value)};e.params=function(a,c,d){b.hook("ComponentJS:params:"+
a,"none",{args:c,spec:d});var f={},e=0,h=0,j={},k;for(k in d)b.isown(d,k)&&("undefined"!==typeof d[k].pos&&(j[d[k].pos]=k,"number"===typeof d[k].pos&&e++,"undefined"!==typeof d[k].req&&d[k].req&&h++),"undefined"!==typeof d[k].def&&(f[k]=d[k].def));var l=!1;if(1===c.length&&"object"===b.istypeof(c[0]))for(k in l=!0,c[0])b.isown(c[0],k)&&"undefined"===typeof d[k]&&(l=!1);if(l){e=c[0];for(k in e)if(b.isown(e,k)){if("undefined"===typeof d[k])throw b.exception(a,'unknown parameter "'+k+'"');if("undefined"!==
typeof d[k].valid&&!b.validate(e[k],d[k].valid))throw b.exception(a,'value of parameter "'+k+'" not valid');f[k]=e[k]}for(k in d)if(b.isown(d,k)&&"undefined"!==typeof d[k].req&&d[k].req&&"undefined"===e[k])throw b.exception(a,'required parameter "'+k+'" missing');}else{if(c.length<h)throw b.exception(a,"invalid number of arguments (at least "+h+" required)");for(k=0;k<e&&k<c.length;k++){if("function"===typeof d[j[k]].valid&&!d[j[k]].valid(c[k]))throw b.exception(a,'value of parameter "'+j[k]+'" not valid');
f[j[k]]=c[k]}if(k<c.length){if("undefined"===typeof j["..."])throw b.exception(a,"too many arguments provided");for(e=[];k<c.length;k++){if("function"===typeof d[j["..."]].valid&&!d[j["..."]].valid(c[k]))throw b.exception(a,'value of parameter "'+j["..."]+'" not valid');e.push(c[k])}f[j["..."]]=e}}return f};b.base16_number=function(a,b,d){var f="";"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=!1);for(d=d?"0123456789ABCDEF":"0123456789abcdef";0<a||0<b;)f=d.charAt(Math.floor(a%16))+f,a=Math.floor(a/
16),0<b&&b--;return f};var q=[0,0,0,0];b.cid=function(){q[3]++;for(var a=0,c=3;0<=c;c--)a+=q[c],q[c]=Math.floor(a%4294967296),a=Math.floor(a/4294967296);return b.base16_number(q[0],8,!0)+b.base16_number(q[1],8,!0)+b.base16_number(q[2],8,!0)+b.base16_number(q[3],8,!0)};b.proxy=function(a,c,d){"string"===b.istypeof(c)&&"object"===b.istypeof(a)&&"function"===b.istypeof(a[c])&&(c=a[c]);b.isdefined(d)||(d=!1);var f=function(){var e=function(){"object"===b.istypeof(arguments.callee.__ctx__)&&(arguments.callee.__ctx__.__this__=
this);return c.apply(arguments.callee.__ctx__,arguments)};e.__ctx__=d?b.clone(b.isdefined(this.__ctx__)?this.__ctx__:a):a;d&&(e.clone=f);e.guid=c.guid=c.guid||e.guid||b.cid();return e};return f.call({})};b.memoize=function(a){var c=function(){var c=b.json(b.slice(arguments,0)),f;"undefined"!==typeof arguments.callee.cache[c]?f=arguments.callee.cache[c]:(f=a.apply(this,arguments),arguments.callee.cache[c]=f);return f};c.cache={};return c};b.curry=function(a){var c=b.slice(arguments,1);return function(){var d=
b.slice(arguments,0),d=b.concat(c,d);return a.apply(this,d)}};e.attribute=function(){var a=e.params("attribute",arguments,{name:{pos:0,def:null,req:!0},def:{pos:1,def:null,req:!0},validate:{pos:2,def:null}});return b.proxy({value:a.def},function(c,d){var f=this.value;if(0<arguments.length){var e=!0;if(null!==a.validate)if("string"===typeof a.validate||"boolean"===typeof a.validate||"number"===typeof a.validate)e=c===a.validate;else if("object"===typeof a.validate&&a.validate instanceof RegExp)e=a.validate.test(c);
else if("function"===typeof a.validate)e=a.validate(c,f,d,a.name);else throw b.exception("attribute",'validation value "'+a.validate+'" for attribute "'+a.name+'" is of unsupported type "'+typeof a.validate+'"');if("undefined"!==typeof d&&d)return e;if(e)this.value=c,e=this.__this__,"undefined"!==typeof e&&"function"===typeof e.notify&&e.notify.call(e,"attribute:set:"+a.name,c,f,a.name);else throw b.exception("attribute",'invalid value "'+c+'" for attribute "'+a.name+'"');}return f},!0)};b.hooks=
{};b.hook_proc={none:{init:void 0,step:function(a,b){return b}},or:{init:!1,step:function(a,b){return a||b}},and:{init:!0,step:function(a,b){return a&&b}},mult:{init:1,step:function(a,b){return a*b}},add:{init:0,step:function(a,b){return a+b}},append:{init:"",step:function(a,b){return a+b}},push:{init:[],step:function(a,b){a.push(b);return a}},concat:{init:[],step:function(a,c){return b.concat(a,c)}},insert:{init:{},step:function(a,b){a[b]=!0;return a}},extend:{init:{},step:function(a,c){return b.extend(a,
c)}}};b.latch=function(a,c){if(2>arguments.length)throw b.exception("latch(internal)","missing arguments");"undefined"===typeof b.hooks[a]&&(b.hooks[a]=[]);var d=b.slice(arguments,2),e=b.cid();b.hooks[a].push({id:e,cb:c,args:d});return e};b.unlatch=function(a,c){if(2!==arguments.length)throw b.exception("unlatch(internal)","invalid number of arguments");if("undefined"===typeof b.hooks[a])throw b.exception("unlatch(internal)","no such hook");for(var d=-1,e=0;e<b.hooks[a].length;e++)if(b.hooks[a][e].id===
c){d=e;break}if(-1===d)throw b.exception("unlatch(internal)","no such latched callback");b.hooks[a]=b.hooks[a].splice(d,1)};b.hook=function(a,c){if(2>arguments.length)throw b.exception("hook(internal)","missing argument");if("undefined"===typeof b.hook_proc[c])throw b.exception("hook(internal)","no such result processing defined");var d=b.hook_proc[c].init;if("undefined"!==typeof b.hooks[a]){var f=b.slice(arguments,2);b.foreach(b.hooks[a],function(a){a=a.cb.apply({args:a.args,_cs:b,$cs:e},f);d=b.hook_proc[c].step(d,
a)})}return d};b.clazz_or_trait=function(a,c){var d=function(){var a=arguments.callee,c=arguments;if(!(this instanceof a))return new a;(function(a,c,d,e){null!==b.annotation(c,"extend")&&arguments.callee(a,b.annotation(c,"extend"),d,!1);if(null!==b.annotation(c,"mixin"))for(var f=b.annotation(c,"mixin"),g=0;g<f.length;g++)arguments.callee(a,f[g],d,!0);if(null!==b.annotation(c,"dynamics")){var f=b.annotation(c,"dynamics"),h;for(h in f)b.isown(f,h)&&(a[h]="null"!==b.istypeof(f[h])&&"function"===b.istypeof(f[h].clone)?
f[h].clone():b.clone(f[h]))}e&&null!==b.annotation(c,"cons")&&(h=b.annotation(c,"cons"),"clazz"===b.istypeof(c)?h.apply(a,d):h.call(a))})(this,a,c,!0)},f=function(a){return!a.match("^(?:base|__ComponentJS_[A-Za-z]+__)$")};if(b.isdefined(a.extend)){b.extend(d,a.extend,f);var g=function(){this.constructor=d};g.prototype=a.extend.prototype;d.prototype=new g;b.annotation(d,"extend",a.extend)}if(b.isdefined(a.mixin)){for(g=0;g<a.mixin.length;g++)b.extend(d,a.mixin[g],f),b.mixin(d.prototype,a.mixin[g].prototype,
f);b.annotation(d,"mixin",a.mixin)}b.isdefined(a.cons)?b.annotation(d,"cons",a.cons):b.isdefined(a.extend)?b.annotation(d,"cons",function(){this.base()}):b.annotation(d,"cons",e.nop);b.annotation(b.annotation(d,"cons"),"name","cons");b.isdefined(a.extend)&&b.annotation(b.annotation(d,"cons"),"base",b.annotation(a.extend,"cons"));b.isdefined(a.setup)&&b.annotation(d,"setup",a.setup);b.isdefined(a.statics)&&b.extend(d,a.statics);b.isdefined(a.protos)&&b.mixin(d.prototype,a.protos);b.isdefined(a.dynamics)&&
b.annotation(d,"dynamics",a.dynamics);var h=function(a,c){for(var d=b.annotation(a,c);null===d&&!0===b.annotation(a.caller,"clone");)d=b.annotation(a.caller,c),a=a.caller;return d};d.prototype.base=function(){var a=h(arguments.callee.caller,"name"),c=h(arguments.callee.caller,"base"),d=b.annotation(this.constructor,"extend");if("function"===b.istypeof(c))return c.apply(this,arguments);if("string"===b.istypeof(a)&&"clazz"===b.istypeof(d)&&"function"===b.istypeof(d[a]))return d[a].apply(this,arguments);
if("string"===b.istypeof(a)&&"clazz"===b.istypeof(d)&&"object"===b.istypeof(d.prototype)&&"function"===b.istypeof(d.prototype[a]))return d.prototype[a].apply(this,arguments);throw b.exception("base",'no base method found for method "'+a+'" in inheritance/mixin chain');};c&&function(a,c){if("array"===b.istypeof(b.annotation(c,"mixin")))for(var d=b.annotation(c,"mixin"),e=0;e<d.length;e++)arguments.callee(a,d[e]);"function"===b.istypeof(b.annotation(c,"setup"))&&b.annotation(c,"setup").call(a)}(d,d);
"string"===typeof a.name&&e.ns(a.name,d);return d};e.clazz=function(){var a=e.params("clazz",arguments,{name:{def:void 0,valid:"string"},extend:{def:void 0,valid:"clazz"},mixin:{def:void 0,valid:"array(trait)"},cons:{def:void 0,valid:"function"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"object"},statics:{def:void 0,valid:"object"}}),a=b.clazz_or_trait(a,!0);b.annotation(a,"type","clazz");return a};e.trait=function(){var a=e.params("trait",arguments,{name:{def:void 0,valid:"string"},
mixin:{def:void 0,valid:"array(trait)"},cons:{def:void 0,valid:"function"},setup:{def:void 0,valid:"function"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"object"},statics:{def:void 0,valid:"object"}}),a=b.clazz_or_trait(a,!1);b.annotation(a,"type","trait");return a};e.pattern.id=e.trait({dynamics:{id:e.attribute("id",null)}});e.pattern.name=e.trait({dynamics:{name:e.attribute("name","")}});e.pattern.tree=e.trait({mixin:[e.pattern.name],dynamics:{parent:e.attribute("parent",null),
children:e.attribute("children",[])},protos:{path:function(a){var b,d;if("undefined"===typeof a){b=[];for(d=this;null!==d;d=d.parent())b.push(d)}else if(b="",null===this.parent())b=a;else for(d=this;null!==d.parent();d=d.parent())b=a+d.name()+b;return b},_attach:function(a){null!==this.parent()&&this.detach();var b=a.children();b.push(this);a.children(b);this.parent(a)},_detach:function(){if(null!==this.parent()){var a=this;this.parent().children(b.filter(this.parent().children(),function(b){return b!==
a}));this.parent(null)}},walk_up:function(a,b){var d,e;d=0;for(e=this;null!==e;e=e.parent(),d++)b=a(d,e,b);return b},walk_down:function(a,b){var d=function(b,c,e){"function"===typeof a&&(e=a(b,c,e,!1));for(var j=c.children(),k=0;k<j.length;k++)e=d(b+1,j[k],e);"function"===typeof a&&(e=a(b,c,e,!0));return e};return b=d(0,this,b)},_tree_dump:function(a){return this.walk_down(function(b,d,e,g){if(!g){for(g=0;g<b;g++)e+="    ";e+='"'+d.name()+'"';"function"===typeof a&&(e+=": "+a(d));e+="\n"}return e},
"")}}});e.pattern.config=e.trait({dynamics:{__config:{}},protos:{cfg:function(a,c){var d;if(0===arguments.length){d=[];for(var e in this.__config)b.isown(this.__config,e)&&d.push(e)}else if(1===arguments.length&&"string"===typeof a)d=this.__config[a];else if(2===arguments.length&&"undefined"!==typeof c)d=this.__config[a],this.__config[a]=c;else if(2===arguments.length)d=this.__config[a],delete this.__config[a];else throw b.exception("cfg","invalid arguments");return d}}});e.pattern.spool=e.trait({dynamics:{__spool:{}},
protos:{spool:function(){var a=e.params("spool",arguments,{name:{pos:0,req:!0},ctx:{pos:1,def:this},func:{pos:2,def:e.nop,req:!0},args:{pos:"...",def:[]}});if(!b.istypeof(a.func).match(/^(string|function)$/))throw b.exception("cleaner","invalid function (either function object or method name required)");if("string"===b.istypeof(a.func)){if("function"!==b.istypeof(a.ctx[a.func]))throw b.exception("cleaner",'invalid method name: "'+a.func+'"');a.func=a.ctx[a.func]}b.isdefined(this.__spool[a.name])||
(this.__spool[a.name]=[]);this.__spool[a.name].push(a)},spooled:function(){var a=e.params("spooled",arguments,{name:{pos:0,req:!0}});return b.isdefined(this.__spool[a.name])&&0<this.__spool[a.name].length},unspool:function(){var a=e.params("unspool",arguments,{name:{pos:0,req:!0}}),c=this.__spool[a.name];if(!b.isdefined(c))throw b.exception("unspool",'no such spool: "'+a.name+'"');for(var d=c.length-1;0<=d;d--)c[d].func.apply(c[d].ctx,c[d].args);delete this.__spool[a.name]}}});e.pattern.property=
e.trait({mixin:[e.pattern.tree,e.pattern.config],protos:{property:function(){var a=e.params("property",arguments,{name:{pos:0,def:null,req:!0},value:{pos:1,def:void 0},bubbling:{def:!0},targeting:{def:!0},returnowner:{def:!1}});if(!a.targeting&&!a.bubbling)throw b.exception("property","disabling both targeting and bubbling makes no sense");var c;c=void 0;var d;d=null;for(var f=this;null!==f;d=f.name(),f=f.parent())if(null!==d||a.targeting){if(null!==d&&(d=f.cfg("ComponentJS:property:"+a.name+"@"+
d),"undefined"!==typeof d)){c=a.returnowner?f:d;break}d=f.cfg("ComponentJS:property:"+a.name);if("undefined"!==typeof d){c=a.returnowner?f:d;break}if(!a.bubbling)break}"undefined"!==typeof a.value&&this.cfg("ComponentJS:property:"+a.name,a.value);return c}}});e.pattern.spec=e.trait({mixin:[e.pattern.name],dynamics:{__spec:{}},protos:{spec:function(){var a=this.__spec;if(0===arguments.length)return a;if(1===arguments.length&&"string"===typeof arguments[0])return a[arguments[0]];for(var c=0;c<arguments.length;c++)if("string"===
typeof arguments[c])a[arguments[c]]=arguments[c+1],c++;else if("object"===typeof arguments[c])for(var d in arguments[c])b.isown(arguments[c],d)&&(a[d]=arguments[c][d])},matches:function(a,c){if("string"===typeof a){if(this.name()!==a)return!1}else if("object"===typeof a&&a instanceof RegExp){if(!this.name().match(a))return!1}else throw b.exception("matches","invalid name pattern");var d=this.__spec,e;for(e in c)if(b.isown(c,e)){if(!b.isdefined(d[e]))return!1;var g=c[e];switch(typeof d[e]){case "number":case "boolean":if(d[e]!==
g)return!1;break;case "string":if(!("string"===typeof g&&d[e]===g||"object"===typeof g&&g instanceof RegExp&&!d[e].match(g)))return!1}}return!0}}});e.pattern.observable=e.trait({dynamics:{__listener:{}},protos:{listen:function(){var a=e.params("listen",arguments,{name:{pos:0,def:null,req:!0},ctx:{pos:1,def:this},func:{pos:2,def:e.nop,req:!0},args:{pos:"...",def:[]},spec:{def:null}}),c=b.cid();this.__listener[c]=a;return c},listening:function(){var a=e.params("listening",arguments,{id:{pos:0,def:null,
req:!0}});return"undefined"!==typeof this.__listener[a.id]},unlisten:function(){var a=e.params("unlisten",arguments,{id:{pos:0,def:null,req:!0}});if("undefined"===typeof this.__listener[a.id])throw b.exception("unlisten","listener not found");var c=this.__listener[a.id];delete this.__listener[a.id];return c},notify:function(){var a=e.params("notify",arguments,{name:{pos:0,def:null,req:!0},args:{pos:"...",def:[]},matches:{def:function(a,b){return a.name===b.name}}}),c;for(c in this.__listener)if(b.isown(this.__listener,
c)){var d=this.__listener[c];if(a.matches(a,d)){var f=b.concat(d.args,a.args);d.func.apply(d.ctx,f)}}}}});e.pattern.event=e.clazz({mixin:[e.pattern.spec],dynamics:{target:e.attribute("target",null),propagation:e.attribute("propagation",!0),processing:e.attribute("processing",!0),dispatched:e.attribute("dispatched",!1),decline:e.attribute("decline",!1),state:e.attribute("state","targeting"),result:e.attribute("result",void 0),async:e.attribute("async",!1)}});e.event=function(){var a=e.params("event",
arguments,{name:{pos:0,def:null,req:!0},spec:{def:{}},target:{pos:1,def:null,req:!0},propagation:{pos:2,def:!0},processing:{pos:3,def:!0},dispatched:{pos:4,def:!1},decline:{pos:5,def:!1},state:{pos:6,def:"targeting"},result:{pos:7,def:void 0},async:{pos:8,def:!1}}),b=new e.pattern.event;b.name(a.name);b.target(a.target);b.propagation(a.propagation);b.processing(a.processing);b.dispatched(a.dispatched);b.decline(a.decline);b.state(a.state);b.result(a.result);b.spec(a.spec);b.async(a.async);return b};
e.pattern.eventing=e.trait({dynamics:{__subscription:{}},protos:{subscribe:function(){var a=e.params("subscribe",arguments,{name:{pos:0,def:null,req:!0},spec:{def:{}},ctx:{def:this},func:{pos:1,def:e.nop,req:!0},args:{pos:"...",def:[]},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0},noevent:{def:!1},exclusive:{def:!1},origin:{def:!1},spool:{def:null}});if(a.exclusive&&0<this.subscribers(a.name,a.spec).length)throw b.exception("subscribe","multiple exclusive subscribers not allowed");var c=
b.cid();this.__subscription[c]=a;null!==a.spool&&this.spool(a.spool,this,"unsubscribe",c);return c},unsubscribe:function(){var a=e.params("unsubscribe",arguments,{id:{pos:0,req:!0}});if("undefined"===typeof this.__subscription[a.id])throw b.exception("unsubscribe","subscription not found");delete this.__subscription[a.id]},subscription:function(){var a=e.params("subscription",arguments,{id:{pos:0,req:!0}});return"undefined"!==typeof this.__subscription[a.id]},subscribers:function(){var a=e.params("subscribers",
arguments,{name:{pos:0,def:null,req:!0},spec:{pos:1,def:{}}}),a=e.event({name:a.name,spec:a.spec}),c=[],d;for(d in this.__subscription)if(b.isown(this.__subscription,d)){var f=this.__subscription[d];a.matches(f.name,f.spec)&&c.push(f)}return c},publish:function(){var a,c=this,d=e.params("publish",arguments,{name:{pos:0,def:null,req:!0},spec:{def:{}},async:{def:!1},capturing:{def:!0},spreading:{def:!0},bubbling:{def:!0},completed:{def:e.nop},resultinit:{def:void 0},resultstep:{def:function(a,b){return b}},
directresult:{def:!1},noresult:{def:!1},firstonly:{def:!1},silent:{def:!1},args:{pos:"...",def:[]}}),f=!1;if(!d.capturing&&!d.spreading&&!d.bubbling){var g=!1,h;for(h in this.__subscription)if(b.isown(this.__subscription,h)){g=!0;break}if(!g){if(d.noresult)return;if(d.directresult)return d.resultinit;f=!0}}var j=e.event({name:d.name,spec:d.spec,async:d.async,result:d.resultinit,target:c,propagation:!0,processing:!0,dispatched:!1});if(f)return j;d.silent||e.debug(1,"event: "+j.target().path("/")+": publish: name="+
j.name()+" async="+j.async()+" capturing="+d.capturing+" spreading="+d.spreading+" bubbling="+d.bubbling+" directresult="+d.directresult+" noresult="+d.noresult+" firstonly="+d.firstonly);var k=function(a,c,d,f,g){for(var h in d.__subscription)if(b.isown(d.__subscription,h)){var k=d.__subscription[h];if(("capturing"===g&&k.capturing||"targeting"===g||"spreading"===g&&k.spreading||"bubbling"===g&&k.bubbling)&&a.matches(k.name,k.spec)){f.silent||e.debug(1,"event: "+d.path("/")+": dispatch on "+g);a.state(g);
a.decline(!1);var j=b.concat(k.origin?[c]:[],k.noevent?[]:[a],k.args,f.args),j=k.func.apply(k.ctx,j);k.noevent&&b.isdefined(j)&&a.result(f.resultstep(a.result(),j));a.decline()||(a.dispatched(!0),f.firstonly&&a.propagation(!1))}}},l=function(b,c,d){var e;if(d.capturing||d.bubbling)e=c.path();if(d.capturing)for(a=e.length-1;1<=a&&!(k(b,c,e[a],d,"capturing"),!b.propagation());a--);b.propagation()&&k(b,c,c,d,"targeting");if(d.spreading&&b.propagation()){var f=function(a,c,e){var g=!0;e||(k(b,a,c,d,"spreading"),
b.propagation()||(b.propagation(!0),g=!1));if(g){c=c.children();for(e=0;e<c.length;e++)f(a,c[e],!1)}};f(c,c,!0)}if(d.bubbling&&b.propagation())for(a=1;a<e.length&&!(k(b,c,e[a],d,"bubbling"),!b.propagation());a++);d.completed.call(c,b)};j.async()?setTimeout(function(){l(j,c,d)},0):l(j,c,d);if(!d.noresult)return d.directresult?j.result():j}}});e.pattern.command=e.clazz({mixin:[e.pattern.observable],dynamics:{ctx:e.attribute("ctx",null),func:e.attribute("func",e.nop),args:e.attribute("args",[]),async:e.attribute("async",
!1),enabled:e.attribute({name:"enabled",def:!0,validate:function(a){return"boolean"===typeof a}})},protos:{execute:function(a,c){if(this.enabled()){var d=[];this.async()&&d.push(function(a){"function"===typeof c&&c(a)});d=b.concat(d,this.args(),a);return this.func().apply(this.ctx(),d)}}}});e.command=function(){var a=e.params("command",arguments,{ctx:{def:null},func:{pos:0,def:null,req:!0},args:{pos:"...",def:[]},async:{def:!1},enabled:{def:!0},wrap:{def:!1}}),c=new e.pattern.command;c.ctx(a.ctx);
c.func(a.func);c.args(a.args);c.async(a.async);c.enabled(a.enabled);var d=c;a.wrap&&(d=function(){var a=b.concat(arguments);return arguments.callee.command.execute.call(arguments.callee.command,a)},d.command=c);return d};b.states=[{enter:null,leave:null,state:"dead",color:"#000000"}];b.states_clear=function(){b.states=b.slice(b.states,0,1)};b.states_add=function(a,c,d,e,g){a={enter:c,leave:d,state:a,color:e};for(c=1;c<b.states.length&&!(null!==g&&b.states[c].state===g);)c++;b.states.splice(c,0,a)};
b.state_name2idx=function(a){var c=-1;for(m=0;m<b.states.length;m++)if(b.states[m].state===a){c=m;break}return c};b.state_requests={};b.state_progression=function(){setTimeout(function(){var a=[],c;for(c in b.state_requests)b.isown(b.state_requests,c)&&b.state_progression_single(b.state_requests[c])&&a.push(c);b.foreach(a,function(a){delete b.state_requests[a]});b.hook("ComponentJS:state-change","none")},0)};b.state_progression_single=function(a){var c=!1;b.state_progression_run(a.comp,a.state);a.comp.state()===
a.state&&("function"===typeof a.callback&&a.callback.call(a.comp,a.state),c=!0);return c};b.state_progression_run=function(a,c,d){var f,g,h;"undefined"===typeof d&&(d="upward-and-downward");var j=b.state_name2idx(c);if(-1===j)throw b.exception("state",'invalid argument "'+c+'"');if(a.__state<j)for(;a.__state<j;){c=b.states[a.__state+1].state;h=b.states[a.__state+1].enter;if(null!==a.parent()&&0>a.parent().state_compare(c)&&(b.state_progression_run(a.parent(),c,"upward"),0>a.parent().state_compare(c))){e.debug(1,
"state: "+a.path("/")+": transition (increase) REJECTED BY PARENT COMPONENT ("+a.parent().path("/")+"): @"+b.states[a.__state].state+" --("+h+")--\x3e @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");break}if(b.isdefined(a.__state_guards[h])){e.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY ENTER GUARD: @"+b.states[a.__state].state+" --("+h+")--\x3e @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");break}a.__state++;e.debug(1,"state: "+
a.path("/")+": transition (increase): @"+b.states[a.__state-1].state+" --("+h+")--\x3e @"+b.states[a.__state].state);b.hook("ComponentJS:state-invalidate","none","states");b.hook("ComponentJS:state-change","none");f="ComponentJS:state:"+b.states[a.__state].state+":enter";a.spooled(f)&&a.unspool(f);f=a.obj();if(null!==f&&"function"===typeof f[h]&&!1===f[h]()){e.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY ENTER METHOD: @"+b.states[a.__state-1].state+" --("+h+")--\x3e @"+b.states[a.__state].state+
": SUSPENDING CURRENT TRANSITION RUN");a.__state--;break}a.publish({name:"ComponentJS:state:"+b.states[a.__state].state,noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0});if("upward-and-downward"===d||"downward"===d){g=a.children();for(f=0;f<g.length;f++)if(0>g[f].state_compare(c)&&(g[f].state_auto_increase()||!0===g[f].property("ComponentJS:state-auto-increase")))b.state_progression_run(g[f],c,"downward"),0>g[f].state_compare(c)&&(b.state_requests[g[f].id()]={comp:g[f],state:c},
b.hook("ComponentJS:state-invalidate","none","requests"),b.hook("ComponentJS:state-change","none"))}}else if(a.__state>j)for(;a.__state>j;){c=b.states[a.__state].leave;h=b.states[a.__state-1].state;g=a.children();for(f=0;f<g.length;f++)if(0<g[f].state_compare(h)&&(b.state_progression_run(g[f],h,"downward"),0<g[f].state_compare(h))){e.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY CHILD COMPONENT ("+g[f].path("/")+"): @"+b.states[a.__state-1].state+" <--("+c+")-- @"+b.states[a.__state].state+
": SUSPENDING CURRENT TRANSITION RUN");return}if(b.isdefined(a.__state_guards[c])){e.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE GUARD: @"+b.states[a.__state-1].state+" <--("+c+")-- @"+b.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");break}a.__state--;e.debug(1,"state: "+a.path("/")+": transition (decrease): @"+b.states[a.__state].state+" <--("+c+")-- @"+b.states[a.__state+1].state);b.hook("ComponentJS:state-invalidate","none","states");b.hook("ComponentJS:state-change",
"none");f="ComponentJS:state:"+b.states[a.__state+1].state+":leave";a.spooled(f)&&a.unspool(f);f=a.obj();if(null!==f&&"function"===typeof f[c]&&!1===f[c]()){e.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE METHOD: @"+b.states[a.__state].state+" <--("+c+")-- @"+b.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");a.__state++;break}a.publish({name:"ComponentJS:state:"+b.states[a.__state].state,noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0});
if("upward-and-downward"===d||"upward"===d)if(null!==a.parent()&&0<a.parent().state_compare(h)&&(a.parent().state_auto_decrease()||!0===a.parent().property("ComponentJS:state-auto-decrease")))b.state_progression_run(a.parent(),h,"upward"),0<a.parent().state_compare(h)&&(b.state_requests[a.parent().id()]={comp:a.parent(),state:h},b.hook("ComponentJS:state-invalidate","none","requests"),b.hook("ComponentJS:state-change","none"))}};e.pattern.state=e.trait({mixin:[e.pattern.tree],dynamics:{__state:0,
__state_guards:{},state_auto_increase:e.attribute("state_auto_increase",!1),state_auto_decrease:e.attribute("state_auto_decrease",!1)},protos:{state:function(){var a=b.states[this.__state].state;if(0===arguments.length)return a;var c=e.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==b.state_name2idx(a)}},callback:{pos:1,def:void 0},sync:{def:!1}});if(b.states[this.__state].state!==c.state){var d=!0,f={comp:this,state:c.state,callback:c.callback};c.sync&&b.state_progression_single(f)&&
(d=!1);d&&(b.state_requests[this.id()]=f,b.hook("ComponentJS:state-invalidate","none","requests"),b.state_progression())}else"function"===typeof c.callback&&c.callback.call(this,c.state);return a},state_compare:function(){var a=e.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==b.state_name2idx(a)}}}),a=b.state_name2idx(a.state);return this.__state-a},guard:function(){var a=e.params("guard",arguments,{method:{pos:0,valid:"string",req:!0},level:{pos:1,valid:"number",req:!0}}),
c=!1;for(m=0;m<b.states.length;m++)if(b.states[m].enter===a.method||b.states[m].leave===a.method){c=!0;break}if(!c)throw b.exception("guard",'no such declared enter/leave method: "'+a.method+'"');b.isdefined(this.__state_guards[a.method])||(this.__state_guards[a.method]=0);c=!1;if(0<a.level)this.__state_guards[a.method]+=a.level;else if(0>a.level){if(this.__state_guards[a.method]<-a.level)throw b.exception("guard","guard level decrease request too large");this.__state_guards[a.method]+=a.level;0===
this.__state_guards[a.method]&&(c=!0)}else this.__state_guards[a.method]=0,c=!0;c&&(delete this.__state_guards[a.method],b.state_progression())}}});e.pattern.service=e.trait({mixin:[e.pattern.eventing],protos:{register:function(){var a=e.params("register",arguments,{name:{pos:0,def:null,req:!0},ctx:{def:this},func:{pos:1,def:e.nop,req:!0},args:{pos:"...",def:[]},async:{def:!1},origin:{def:!1},spool:{def:null},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0}}),b=e.command({ctx:a.ctx,func:a.func,
args:a.args,async:a.async,wrap:!0});b.command.listen({name:"attribute:set:enabled",args:[this,a.name],func:function(a,b,c,e){a.publish({name:"ComponentJS:service:"+b+":enabled",args:[c,e],capturing:!1,spreading:!1,bubbling:!1,async:!0,noresult:!0})}});b=this.subscribe({name:"ComponentJS:service:"+a.name,ctx:a.ctx,func:b,noevent:!0,origin:a.origin,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,exclusive:!0});null!==a.spool&&this.spool(a.spool,this,"unregister",b);return b},unregister:function(){var a=
e.params("unregister",arguments,{id:{pos:0,req:!0}});this.unsubscribe(a.id)},service_enabled:function(){var a=e.params("service_enabled",arguments,{name:{pos:0,def:null,req:!0},value:{pos:1,def:void 0}}),b=this.subscribers(a.name);return 1!==b.length?void 0:b[0].func().command.enabled(a.value)},call:function(){var a=e.params("call",arguments,{name:{pos:0,def:null,req:!0},args:{pos:"...",def:[]},result:{def:null},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0}}),c=this.publish({name:"ComponentJS:service:"+
a.name,args:a.args,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,firstonly:!0,async:!1});if(!c.dispatched())throw b.exception("call",'no such registered service found: "'+a.name+'"');return c.result()}}});e.pattern.shadow=e.trait({dynamics:{__obj:null},protos:{obj:function(a){if("undefined"===typeof a)return this.__obj;if("object"===typeof a)null!==a?(b.annotation(a,"comp",this),this.__obj=a):(null!==this.__obj&&b.annotation(this.__obj,"comp",null),this.__obj=null);else throw b.exception("obj",
"invalid argument");return this},access:function(a,c){if("undefined"===typeof a)throw b.exception("access","no attribute name given");var d=this.obj();if(null===d)throw b.exception("access","still no object attached");if("undefined"===typeof d[a])throw b.exception("access",'invalid attribute "'+a+'"');var e=d[a];"undefined"!==typeof c&&(d[a]=c);return e},invoke:function(a){if("undefined"===typeof a)throw b.exception("invoke","no method name given");var c=this.obj();if(null===c)throw b.exception("invoke",
"still no object attached");if("undefined"===typeof c[a])throw b.exception("invoke",'invalid method "'+a+'"');if("function"!==b.istypeof(c[a]))throw b.exception("invoke",'anything named "'+a+'" existing, but not a function');var d=b.slice(arguments,1);return c[a].apply(c,d)}}});e.pattern.socket=e.trait({mixin:[e.pattern.tree,e.pattern.property],dynamics:{__plugs:{}},protos:{socket:function(){var a=e.params("socket",arguments,{name:{def:"default"},scope:{def:null},ctx:{pos:0,def:null,req:!0},plug:{pos:1,
def:null,req:!0},unplug:{pos:2,def:null,req:!0}});if("string"===b.istypeof(a.plug)&&"function"!==b.istypeof(a.ctx[a.plug]))throw b.exception("socket",'no plug method named "'+a.plug+'" found on context object');if("string"!==b.istypeof(a.plug)&&"function"!==b.istypeof(a.plug))throw b.exception("socket","plug operation neither method name nor function");if("string"===b.istypeof(a.unplug)&&"function"!==b.istypeof(a.ctx[a.unplug]))throw b.exception("socket",'no unplug method named "'+a.unplug+'" found on context object');
if("string"!==b.istypeof(a.unplug)&&"function"!==b.istypeof(a.unplug))throw b.exception("socket","unplug operation neither method name nor function");var c="ComponentJS:socket:"+a.name;null!==a.scope&&(c+="@"+a.scope);e(this).property(c,a)},link:function(){var a=e.params("link",arguments,{name:{def:"default"},scope:{def:null},target:{pos:0,req:!0},socket:{pos:1,req:!0}});this.socket({name:a.name,scope:a.scope,ctx:{},plug:function(c){var d=b.annotation(c,"link");if(null!==d)throw b.exception("link:plug: cannot plug, you have to unplug first");
d=e(a.target).plug({name:a.socket,object:c});b.annotation(c,"link",d)},unplug:function(c){var d=b.annotation(c,"link");if(null===d)throw b.exception("link:unplug: cannot unplug, you have to plug first");e(a.target).unplug(d);b.annotation(c,"link",null)}})},plug:function(){var a=e.params("plug",arguments,{name:{def:"default"},object:{pos:0,req:!0},spool:{def:null}}),c=b.cid();this.__plugs[c]=a;b.plugger("plug",this,a.name,a.object);null!==a.spool&&this.spool(a.spool,this,"unplug",c);return c},unplug:function(){var a=
e.params("unplug",arguments,{id:{pos:0,req:!0}});if("undefined"===typeof this.__plugs[a.id])throw b.exception("unplug","plugging not found");b.plugger("unplug",this,this.__plugs[a.id].name,this.__plugs[a.id].object);delete this.__plugs[a.id]}}});b.plugger=function(a,c,d,f){var g="ComponentJS:socket:"+d,h=c.property({name:g,targeting:!1});if(!b.isdefined(h))throw b.exception(a,"no socket found on parent component(s)");g=c.property({name:g,targeting:!1,returnowner:!0});e.debug(1,"socket: "+g.path("/")+
": "+d+" <--("+a+")-- "+c.path("/"));if("string"===b.istypeof(h[a]))h.ctx[h[a]].call(h.ctx,f);else if("function"===b.istypeof(h[a]))h[a].call(h.ctx,f);else throw b.exception(a,'failed to perform "'+a+'" operation');};e.pattern.hook=e.trait({mixin:[e.pattern.eventing],protos:{latch:function(){var a=e.params("latch",arguments,{name:{pos:0,def:null,req:!0},ctx:{def:this},func:{pos:1,def:e.nop,req:!0},args:{pos:"...",def:[]},spool:{def:null}}),b=this.subscribe({name:"ComponentJS:hook:"+a.name,ctx:a.ctx,
func:a.func,args:a.args,noevent:!0});null!==a.spool&&this.spool(a.spool,this,"unlatch",b);return b},unlatch:function(){var a=e.params("unlatch",arguments,{id:{pos:0,req:!0}});this.unsubscribe(a.id)},hook:function(){var a=e.params("hook",arguments,{name:{pos:0,def:null,req:!0},proc:{pos:1,def:"none",valid:function(a){return b.isdefined(b.hook_proc[a])}},args:{pos:"...",def:[]}});return this.publish({name:"ComponentJS:hook:"+a.name,args:a.args,capturing:!1,spreading:!1,bubbling:!1,async:!1,resultinit:b.hook_proc[a.proc].init,
resultstep:b.hook_proc[a.proc].step,directresult:!0})}}});e.mark=function(a,c){var d=b.annotation(a,"marker");null===d&&(d={});d[c]=!0;b.annotation(a,"marker",d)};e.marked=function(a,c){var d=b.annotation(a,"marker");null===d&&(d={});return!0===d[c]};e.marker.service=e.trait({cons:function(){e.mark(this,"service")}});e.marker.controller=e.trait({cons:function(){e.mark(this,"controller")}});e.marker.model=e.trait({cons:function(){e.mark(this,"model")}});e.marker.view=e.trait({cons:function(){e.mark(this,
"view")}});b.store_id=function(a){var b="ComponentJS:store:",b="undefined"!==typeof n&&"undefined"!==typeof n.location&&"string"===typeof n.location.pathname?b+n.location.pathname:b+"unknown-path";return b+=":"+a.path("/")};b.store_load=function(a){if(null===a.__store){if("undefined"!==typeof l.localStorage&&"undefined"!==typeof l.JSON){var c=b.store_id(a),c=l.localStorage.getItem(c);"string"===typeof c&&(a.__store=l.JSON.parse(c))}if(null===a.__store||"object"!==typeof a.__store)a.__store={}}};b.store_save=
function(a){if(null!==a.__store&&"undefined"!==typeof l.localStorage&&"undefined"!==typeof l.JSON){var c=b.store_id(a);a=l.JSON.stringify(a.__store);"{}"===a?l.localStorage.removeItem(c):l.localStorage.setItem(c,a)}};e.pattern.store=e.trait({dynamics:{__store:null},protos:{store:function(){var a,c;if(0===arguments.length){b.store_load(this);c=[];for(a in this.__store)c.push(a);return c}if(1===arguments.length&&null===arguments[0])return this.__store={},b.store_save(this),null;if(1===arguments.length&&
"string"===typeof arguments[0])return b.store_load(this),a=arguments[0],"undefined"===typeof this.__store[a]?null:this.__store[a];if(2===arguments.length&&null===arguments[1])return b.store_load(this),a=arguments[0],delete this.__store[a],b.store_save(this),null;if(2===arguments.length)return b.store_load(this),a=arguments[0],c=arguments[1],this.__store[a]=c,b.store_save(this),c;throw b.exception("store","invalid argument(s)");}}});e.pattern.model=e.trait({protos:{model:function(a){var c;if(b.isdefined(a))for(c in a){"undefined"===
typeof a[c].value&&(a[c].value="");"undefined"===typeof a[c].valid&&(a[c].valid="string");"undefined"===typeof a[c].autoreset&&(a[c].autoreset=!1);"undefined"===typeof a[c].store&&(a[c].store=!1);for(var d in a[c])if("value"!==d&&"valid"!==d&&"autoreset"!==d&&"store"!==d)throw b.exception("model",'invalid specification key "'+d+'" in specification of model field "'+c+'"');}var e=this.store("model");if(null!==e)for(c in a)a[c].store&&b.isdefined(e[c])&&(a[c].value=e[c]);d=this.property({name:"ComponentJS:model",
bubbling:!1});if(b.isdefined(a)){b.isdefined(d)?(e={},b.extend(e,d),b.extend(e,a),this.property("ComponentJS:model",e),a=e):this.property("ComponentJS:model",a);var e={},g=!1;for(c in a)a[c].store&&(e[c]=a[c].value,g=!0);g&&this.store("model",e)}return d},value:function(){for(var a=e.params("value",arguments,{name:{pos:0,def:null,req:!0},value:{pos:1,def:void 0},force:{pos:2,def:!1},returnowner:{def:!1}}),c=null,d=null,f=this;null!==f;){c=f.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("value",
'no model found containing value "'+a.name+'"');d=c.property("ComponentJS:model");if(b.isdefined(d[a.name]))break;f=c.parent()}if(null===f)throw b.exception("value",'no model found containing value "'+a.name+'"');var f=a.value,g,h=d[a.name].value;"undefined"===typeof f&&!0===c.property({name:"ComponentJS:model:subscribers:get",bubbling:!1})&&(g=c.publish({name:"ComponentJS:model:"+a.name+":get",args:[h],capturing:!1,spreading:!1,bubbling:!1,async:!1}),g.processing()&&(h=d[a.name].value,g=g.result(),
"undefined"!==typeof g&&(h=g)));if("undefined"!==typeof f&&(a.force||h!==f)){if(!b.validate(f,d[a.name].valid))throw b.exception("value",'invalid value "'+f+'" for model field "'+a.name+'"');var j=!0;!0===c.property({name:"ComponentJS:model:subscribers:set",bubbling:!1})&&(g=c.publish({name:"ComponentJS:model:"+a.name+":set",args:[f,h],capturing:!1,spreading:!1,bubbling:!1,async:!1}),g.processing()?(g=g.result(),"undefined"!==typeof g&&(f=g)):j=!1);j&&!d[a.name].autoreset&&(d[a.name].value=f,d[a.name].store&&
(j=c.store("model"),j[a.name]=d[a.name].value,c.store("model",j)),!0===c.property({name:"ComponentJS:model:subscribers:changed",bubbling:!1})&&c.publish({name:"ComponentJS:model:"+a.name+":changed",args:[f,h],noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!1}))}return a.returnowner?c:h},touch:function(){var a=e.params("touch",arguments,{name:{pos:0,req:!0}});this.value({name:a.name,value:this.value(a.name),force:!0})},observe:function(){for(var a=e.params("observe",arguments,{name:{pos:0,
req:!0},func:{pos:1,req:!0},touch:{def:!1},operation:{def:"set"},spool:{def:null}}),c=null,d=null,f=this;null!==f;){c=f.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("observe",'no model found containing value "'+a.name+'"');d=c.property("ComponentJS:model");if(b.isdefined(d[a.name]))break;f=c.parent()}if(null===f)throw b.exception("observe",'no model found containing value "'+a.name+'"');d=c.subscribe({name:"ComponentJS:model:"+a.name+":"+a.operation,capturing:!1,
spreading:!1,bubbling:!1,func:a.func});c.property("ComponentJS:model:subscribers:"+a.operation,!0);null!==a.spool&&this.spool(a.spool,this,"unobserve",d);a.touch&&this.touch(a.name);return d},unobserve:function(){for(var a=e.params("unobserve",arguments,{id:{pos:0,req:!0}}),c=null,d=this;null!==d;){c=d.property({name:"ComponentJS:model",returnowner:!0});if(!b.isdefined(c))throw b.exception("unobserve","no model subscription found");if(c.subscription(a.id))break;d=c.parent()}if(null===d)throw b.exception("unobserve",
"no model subscription found");c.unsubscribe(a.id)}}});b.comp=null;b.none=null;b.root=null;b.comp_mixins=[e.pattern.id,e.pattern.name,e.pattern.tree,e.pattern.config,e.pattern.spool,e.pattern.state,e.pattern.service,e.pattern.eventing,e.pattern.property,e.pattern.shadow,e.pattern.socket,e.pattern.model,e.pattern.store];b.comp_cons=function(a,c,d){b.annotation(this,"type","component");"string"!==b.istypeof(a)&&(a="<unknown>");this.name(a);this.parent("object"===b.istypeof(c)?c:null);this.children("array"===
b.istypeof(d)?d:[])};b.comp_protos={create:function(){return e.create.apply(this,b.concat([this],arguments))},destroy:function(){return e.destroy.apply(this,b.concat([this],arguments))},exists:function(){return"<none>"!==this.name()}};b.bootstrapped=!1;e.bootstrap=function(){if(b.bootstrapped)throw b.exception("bootstrap","library already bootstrapped");b.hook("ComponentJS:bootstrap:comp:mixin","none",b.comp_mixins);b.hook("ComponentJS:bootstrap:comp:protos","none",b.comp_protos);b.comp=e.clazz({mixin:b.comp_mixins,
cons:b.comp_cons,protos:b.comp_protos});b.root=new b.comp("<root>",null,[]);b.none=new b.comp("<none>",null,[]);b.foreach("create destroy guard hook invoke latch link listen listening model notify observe plug property publish register service_enabled socket spool spooled state state_compare store subscribe subscribers touch unlatch unlisten unobserve unplug unregister unspool unsubscribe value values".split(" "),function(a){b.none[a]=function(){throw b.exception(a,'no such component (you are calling method "'+
a+'" on component "<none>")');}});b.hook("ComponentJS:bootstrap","none");b.bootstrapped=!0};e.shutdown=function(){if(!b.bootstrapped)throw b.exception("shutdown","library still not bootstrapped");b.hook("ComponentJS:shutdown","none");b.none=null;b.root.destroy();b.root=null;b.comp=null;b.bootstrapped=!1};b.lookup=function(a,c){1===arguments.length&&("string"===b.istypeof(arguments[0])?(c=a,a=b.root):c="");if("string"!==typeof c)return b.none;if("<root>"===c)return b.root;if("<none>"===c)return b.none;
var d;if("/"===c.substr(0,1))d=b.root,c=c.substring(1);else{d=b.istypeof(a);var e=b.annotation(a,"comp");if("component"!==d&&null!==e)d=e;else{if("component"!==d)throw b.exception("lookup",'invalid base component (type is "'+d+'")');d=a}}if(""!==c)if(e=[],b.lookup_step(e,d,c.split("/"),0),0===e.length)d=b.none;else if(1===e.length)d=e[0];else{var g={},e=b.filter(e,function(a){a=a.id();var b="undefined"===typeof g[a];g[a]=!0;return b});if(1===e.length)d=e[0];else{for(var h="",j=0;j<e.length;j++)h+=
" "+e[j].path("/");throw b.exception("lookup",'ambiguous component path "'+c+'" at '+d.path("/")+": expected only 1 component, but found "+e.length+" components:"+h);}}return d};b.lookup_step=function(a,c,d,e){var g;if(e>=d.length)a.push(c);else if("."===d[e])b.lookup_step(a,c,d,e+1);else if(".."===d[e])null!==c.parent()&&b.lookup_step(a,c.parent(),d,e+1);else if("*"===d[e]){g=c.children();for(c=0;c<g.length;c++)b.lookup_step(a,g[c],d,e+1)}else if(""===d[e]){g=c.walk_down(function(a,b,c,d){d||c.push(b);
return c},[]);for(c=0;c<g.length;c++)b.lookup_step(a,g[c],d,e+1)}else{g=c.children();for(c=0;c<g.length;c++)if(g[c].name()===d[e]){b.lookup_step(a,g[c],d,e+1);break}}};e.create=function(){b.bootstrapped||(alert('WARNING: ComponentJS still not bootstrapped (please call "bootstrap" method before first "create" method call!)'),e.bootstrap());if(2>arguments.length)throw b.exception("create","invalid number of arguments");var a=0,c=null,d=null,f=[];if("string"===b.istypeof(arguments[a])){if("/"!==arguments[a].substr(0,
1))throw b.exception("create",'either base component has to be given or the tree specification has to start with the root component ("/")');c=b.root}else if(d=arguments[a++],"component"!==b.istypeof(d)&&(d=b.annotation(d,"comp"),null===d))throw b.exception("create","invalid base argument (not an object attached to a component)");for(var g=[],h=arguments[a++],j;""!==h;){j=h.match(/^\s*([^\/{},]+|[\/{},])/);if(null===j)break;g.push(j[1]);h=h.substr(j[1].length)}h=function(a,b){for(var c="",d=0;d<b&&
d<a.length;d++)c+=a[d];if(d<a.length){c=c+"<"+a[d++];for(c+=">";d<a.length;d++)c+=a[d]}return c};for(j=0;j<g.length;j++)if("/"===g[j]){if(null===c)throw b.exception("create","no parent component for step-down at "+h(g,j));d=c}else if("{"===g[j])f.push(d);else if(","===g[j]){if(0===f.length)throw b.exception("create","no open brace section for parallelism at "+h(g,j));d=f[f.length-1]}else if("}"===g[j]){if(0===f.length)throw b.exception("create","no more open brace section for closing at "+h(g,j));
d=f.pop();c=null}else{if(null===d)throw b.exception("create","no base component at "+h(g,j));c=b.create_single(d,g[j],arguments[a++])}if(0<f.length)throw b.exception("create","still open brace sections at end of tree specification");return c};b.create_single=function(a,c,d){if("string"!==typeof c)throw b.exception("create","invalid path argument (not a string)");var f=c.match(/^(.*?)\/?([^\/]+)$/);if(!f[0])throw b.exception("create",'invalid path "'+c+'"');var g=f[1],f=f[2];c=b.cid();f=f.replace(/\{id\}/g,
c);a=b.lookup(a,g);if(a===b.none)throw b.exception("create",'parent component path "'+g+'" not already existing (please create first)');g=b.lookup(a,f);if(g!==b.none)throw b.exception("create",'leaf component path "'+f+'" already existing (please destroy first)');var h=null;switch(b.istypeof(d)){case "clazz":case "trait":case "function":h=new d;break;case "object":h=d;break;case "null":break;default:throw b.exception("create","invalid class argument");}g=new b.comp(f);g.id(c);g._attach(a);g.obj(h);
e.debug(1,"component: "+g.path("/")+": created component ["+g.id()+"]");g.state({state:"created",sync:!0});b.hook("ComponentJS:state-invalidate","none","components");b.hook("ComponentJS:state-change","none");return g};e.destroy=function(){if(1!==arguments.length&&2!==arguments.length)throw b.exception("destroy","invalid number of arguments");var a=b.lookup.apply(this,arguments);if(a===b.none)throw b.exception("destroy","no such component found to destroy");if(a===b.root)throw b.exception("destroy",
"root component cannot be destroyed");a.state({state:"dead",sync:!0});a._detach();a.obj(null);e.debug(1,"component: "+a.path("/")+": destroyed component ["+a.id()+"]");b.hook("ComponentJS:state-invalidate","none","components");b.hook("ComponentJS:state-change","none")};e.transition=function(){if(1===arguments.length&&null===arguments[0])b.states_clear();else{var a=e.params("transition",arguments,{target:{pos:0,def:null,req:!0},enter:{pos:1,def:null,req:!0},leave:{pos:2,def:null,req:!0},color:{pos:3,
def:null,req:!0},source:{def:null}});b.states_add(a.target,a.enter,a.leave,a.color,a.source)}};e.transition("created","create","destroy","#cc3333");e.transition("configured","setup","teardown","#eabc43");e.transition("prepared","prepare","cleanup","#f2ec00");e.transition("materialized","render","release","#6699cc");e.transition("visible","show","hide","#669933");if("object"===typeof s&&"undefined"===typeof l.ComponentJS_export||"undefined"!==typeof l.ComponentJS_export&&"CommonJS"===l.ComponentJS_export)s.ComponentJS=
e;else if("function"===typeof p&&"object"===typeof p.amd&&"undefined"===typeof l.ComponentJS_export||"undefined"!==typeof l.ComponentJS_export&&"AMD"===l.ComponentJS_export)p("ComponentJS",function(){return e});else{s="ComponentJS";p=n.getElementsByTagName("script");for(var A=/^(?:.*\/)?component(?:-[0-9]+(?:\.[0-9]+)*)?(?:-min)?\.js$/,m=0;m<p.length;m++){var t=p[m].getAttribute("src");if(null!==t&&A.exec(t)&&(t=p[m].getAttribute("data-symbol"),null!==t)){s=t;break}}e.symbol(s)}b.plugins={};e.plugin=
function(a,c){if(0===arguments.length){var d=[];for(a in b.plugins)b.isown(b.plugins,a)&&d.push(a);return d}if(1===arguments.length){if("string"!==typeof a)throw b.exception("plugin","invalid plugin name parameter");return"undefined"!==typeof b.plugins[a]}if(2===arguments.length){if("string"!==typeof a)throw b.exception("plugin","invalid plugin name parameter");if("undefined"!==typeof b.plugins[a])throw b.exception("plugin",'plugin named "'+a+'" already registered');c.call(this,b,e,l,n);b.plugins[a]=
!0}else throw b.exception("plugin","invalid number of parameters");}})("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof this?this:{},"undefined"!==typeof document?document:"undefined"!==typeof this?this:{},"object"===typeof exports?exports:void 0,"function"===typeof define?define:void 0);
