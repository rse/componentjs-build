/*
**  ComponentJS -- Component System for JavaScript <http://componentjs.com>
**  Copyright (c) 2009-2013 Ralf S. Engelschall <http://engelschall.com>
**
**  This Source Code Form is subject to the terms of the Mozilla Public
**  License, v. 2.0. If a copy of the MPL was not distributed with this
**  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

ComponentJS.plugin("debugger",function(a,m,h,w){a.jq=function(d,b){var c=[];1===arguments.length&&"string"!==typeof d?c.push(d):("undefined"===typeof b&&(b=w),c=b.querySelectorAll(d),c=a.concat([],c));a.extend(c,a.jq_methods);return c};a.jq_methods={ready:function(a){for(var b=0;b<this.length;b++)(function(b){var f=this[b];setTimeout(function(){a.call(f)},250)})(b)},bind:function(a,b){for(var c=0;c<this.length;c++)"function"===typeof this[c].addEventListener?this[c].addEventListener(a,b,!1):"function"===
typeof this[c].attachEvent&&this[c].attachEvent("on"+a,b);return this},width:function(a){for(var b="undefined"!==typeof a?this:void 0,c=0;c<this.length;c++)"undefined"===typeof a?(b=this[c].offsetWidth,"undefined"===typeof b&&(b=this[c].innerWidth),"undefined"===typeof b&&(b=this[c].clientWidth)):this[c].style.width=a;return b},height:function(a){for(var b="undefined"!==typeof a?this:void 0,c=0;c<this.length;c++)"undefined"===typeof a?(b=this[c].offsetHeight,"undefined"===typeof b&&(b=this[c].innerHeight),
"undefined"===typeof b&&(b=this[c].clientHeight)):this[c].style.height=a;return b},attr:function(a,b){for(var c="undefined"!==typeof b?this:void 0,f=0;f<this.length;f++)"undefined"===typeof b?c=this[f].getAttribute(a):this[f].setAttribute(a,b);return c},html:function(d){for(var b=0;b<this.length;b++)try{this[b].innerHTML=d}catch(c){var f=a.dbg.document.createElement("div");for(f.innerHTML="<div>"+d+"</div>";this[b].firstChild;)this[b].removeChild(this[b].firstChild);for(var m=0;m<f.firstChild.childNodes.length;m++)this[b].appendChild(f.firstChild.childNodes[m])}return this},
scrollTop:function(a){for(var b=0;b<this.length;b++)this[b].scrollTop=a;return this},get:function(a){return this[a]}};a.dbg=null;a.dbg_state_invalid={components:!1,states:!1,requests:!1,console:!1};a.dbg_state_invalidate=function(d){a.dbg_state_invalid[d]=!0};a.dbg_logline=0;a.dbg_logbook="";a.dbg_log=function(d){null!==a.dbg&&(d=d.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("\n","<br/>"),a.dbg_logline++,d=d.replace(/(DEBUG\[\d+\]: )([^:]+)/,'<span class="prefix">$1</span><span class="context">$2</span>'),
d=d.replace(/(\s+)(\/[^:\s]*)/g,'$1<span class="path">$2</span>'),d=d.replace(/(\s+)(@[a-z]+)/g,'$1<span class="state">$2</span>'),d=d.replace(/((?:&lt;)?--\()([a-z]+)(\)--(?:&gt;)?)/g,'<span class="arrow">$1</span><span class="method">$2</span><span class="arrow">$3</span>'),a.dbg_logbook+='<table class="line"><tr><td class="num">'+a.dbg_logline+'.</td><td class="msg">'+d+"</td></tr></table>",a.dbg_state_invalidate("console"),a.dbg_update())};a.dbg_natural=!1;m.debug_instrumented=function(){return"undefined"!==
typeof h&&h.console&&(h.console.firebug||120<h.outerHeight-h.innerHeight)};a.isIE=function(){return"undefined"!==typeof navigator&&"Microsoft Internet Explorer"===navigator.appName&&navigator.userAgent.match(/MSIE ([0-9]+[.0-9]*)/)};m.debug_window=function(){var d=m.params("debugger",arguments,{enable:{pos:0,def:null},autoclose:{pos:1,def:!1},name:{pos:2,def:null},width:{def:800},height:{def:600},natural:{def:!1}});if(null===d.enable)return null!==a.dbg;if(d.enable){a.dbg_natural=d.natural;if(null===
a.dbg){var b="ComponentJS Debugger";null!==typeof d.name&&(b+=" ("+d.name+")");var c=b,f;f="location=no,scrollbars=no,toolbars=no,menubar=no,status=no"+(",width="+d.width+",height="+d.height);a.isIE()?c=c.replace(/ /g,"_").replace(/[()]/g,""):f+=",replace=yes";a.dbg=h.open("about:blank",c,f);a.isIE()&&(a.dbg.close(),a.dbg=h.open("about:blank",c,f));setTimeout(function(){a.jq(a.dbg.document).ready(function(){d.autoclose&&a.jq(h).bind("beforeunload",function(){null!==a.dbg&&a.dbg.close()});a.jq("html head",
a.dbg.document).html("<title>"+b+"</title>");a.jq("html body",a.dbg.document).html('<style type="text/css">html, body {margin: 0px;padding: 0px;}.dbg {width: 100%;height: 100%;font-family: Helvetica, Arial, sans-serif;background-color: #e0e0e0;overflow: hidden;font-size: 9pt;}.dbg .header {width: 100%;height: 30px;background-color: #000000;text-align: center;position: relative;}.dbg .header .text {position: relative;top: 6px;color: #ffffff;font-size: 12pt;font-weight: bold;}.dbg .viewer {width: 100%;height: 50%;background-color: #d0d0d0;overflow: hidden;}.dbg .viewer canvas {position: relative;top: 10px;left: 10px;width: 100%;height: 100%;}.dbg .status {width: 100%;height: 20px;background-color: #000000;color: #f0f0f0;text-align: center;}.dbg .status .text {position: relative;top: 3px;color: #ffffff;font-size: 9pt;}.dbg .console {width: 100%;height: 50%;background-color: #ffffff;color: #000000;overflow: scroll;font-size: 9pt;}.dbg .console .text {width: 100%;height: auto;}.dbg .console .text .line {border-collapse: collapse;width: 100%;border-bottom: 1px solid #d0d0d0;font-size: 9pt;}.dbg .console .text .num {width: 40px;background-color: #f0f0f0;text-align: right;}.dbg .console .text .msg {padding-left: 10px;}.dbg .console .text .msg .prefix {color: #999999;}.dbg .console .text .msg .context {font-weight: bold;}.dbg .console .text .msg .path {color: #003399;}.dbg .console .text .msg .state {font-style: italic;}.dbg .console .text .msg .arrow {color: #999999;}.dbg .console .text .msg .method {font-family: monospace;}</style><div class="dbg"><div class="header"><div class="text">'+
b+'</div></div><div class="viewer"><canvas></canvas></div><div class="status"><div class="text"></div></div><div class="console"><div class="text"></div></div></div>');a.dbg_refresh();a.jq(a.dbg).bind("resize",function(){a.dbg_refresh()})})},500)}m.debug(3,"debugger enabled")}else null!==a.dbg&&(m.debug(3,"debugger disabled"),a.dbg.close(),a.dbg=null)};a.dbg_refresh=function(){var d=a.jq(a.dbg).width(),b=a.jq(a.dbg).height();a.jq(".dbg",a.dbg.document).width(d).height(b);var c=b-(a.jq(".dbg .header",
a.dbg.document).height()+a.jq(".dbg .status",a.dbg.document).height()),b=Math.ceil(c/2),c=Math.floor(c/2);a.jq(".dbg .viewer",a.dbg.document).height(b);a.jq(".dbg .console",a.dbg.document).height(c);a.jq(".dbg .viewer canvas",a.dbg.document).height(b-20).attr("height",b-20).width(d-20).attr("width",d-20);a.dbg_update()};a.dbg_timer=null;a.dbg_update=function(){null!==a.dbg&&null===a.dbg_timer&&(a.dbg_timer=setTimeout(function(){a.dbg_update_once();a.dbg_timer=null},250))};a.dbg_update_once=function(){a.dbg_state_invalid.console&&
(a.jq(".dbg .console .text",a.dbg.document).html(a.dbg_logbook),a.jq(".dbg .console",a.dbg.document).scrollTop(a.jq(".dbg .console .text",a.dbg.document).height()),a.dbg_state_invalid.console=!0);if(a.dbg_state_invalid.components||a.dbg_state_invalid.requests||a.dbg_state_invalid.states){var d,b,c;if(a.dbg_state_invalid.components||a.dbg_state_invalid.states)d=a.root.walk_down(function(b,c,e,d){if(d){d=b=0;for(var f=c.children(),j=0;j<f.length;j++)b+=a.annotation(f[j],"debugger_width"),d+=a.annotation(f[j],
"debugger_total");0===d&&b++;d++;a.annotation(c,"debugger_width",b);a.annotation(c,"debugger_total",d)}else a.annotation(c,"debugger_depth",b),e=b>e?b:e;return e},1),b=a.annotation(a.root,"debugger_width"),c=a.annotation(a.root,"debugger_total");if(a.dbg_state_invalid.components||a.dbg_state_invalid.requests){var f=0,h;for(h in a.state_requests)a.isown(a.state_requests,h)&&f++;a.jq(".dbg .status .text",a.dbg.document).html("Created Components: <b>"+c+"</b>, Pending Transition Requests: <b>"+f+"</b>");
a.dbg_state_invalid.requests=!0}if(a.dbg_state_invalid.components||a.dbg_state_invalid.states){var e=a.jq(".dbg .viewer canvas",a.dbg.document).get(0);if("undefined"===typeof e)return;var e=e.getContext("2d"),t=a.jq(".dbg .viewer canvas",a.dbg.document).height();c=a.jq(".dbg .viewer canvas",a.dbg.document).width();var u=Math.floor(c/b),p=Math.floor(t/(d+1)),v=Math.floor(u/8),r=Math.floor(p/3);e.clearRect(0,0,c,t);var s=a.dbg_natural;a.root.walk_down(function(b,c,d,f){if(f){f=a.annotation(c,"debugger_depth");
var k,j;if(1===a.annotation(c,"debugger_total"))b=u*d++,f=s?t-p*f-p:p*f,k=u-v,j=p-r;else{var g=c.children();b=a.annotation(g[0],"debugger_x");a.annotation(g[0],"debugger_y");k=b;1<g.length&&(k=a.annotation(g[g.length-1],"debugger_x"),a.annotation(g[g.length-1],"debugger_y"));b+=Math.ceil((k-b)/2);f=s?t-p*f-p:p*f;k=u-v;j=p-r;for(var h=0;h<g.length;h++){var q=a.annotation(g[h],"debugger_x"),n=a.annotation(g[h],"debugger_y"),l=a.annotation(g[h],"debugger_w");e.strokeStyle="#888888";e.lineWidth=2;e.beginPath();
e.moveTo(b+Math.ceil(k/2),f+(s?0:j));e.lineTo(b+Math.ceil(k/2),f+(s?-Math.ceil(r/2):j+Math.ceil(r/2)));e.lineTo(q+Math.ceil(l/2),f+(s?-Math.ceil(r/2):j+Math.ceil(r/2)));e.lineTo(q+Math.ceil(l/2),n+(s?j:0));e.stroke()}}g="";m.marked(c.obj(),"view")&&(g+="V");m.marked(c.obj(),"model")&&(g+="M");m.marked(c.obj(),"controller")&&(g+="C");m.marked(c.obj(),"service")&&(g+="S");"V"===g?(n="#14426f",h="#ffffff",l="#2068b0",q="#adcef0"):"M"===g?(n="#6f5014",h="#ffffff",l="#9a6f1c",q="#e8c581"):"S"===g?(n="#e8e8e8",
h="#000000",l="#ffffff",q="#666666"):(n="#444444",h="#ffffff",l="#777777",q="#cccccc");e.save();e.fillStyle=n;e.shadowColor="#888888";e.shadowBlur=6;e.shadowOffsetX=1;e.shadowOffsetY=1;e.fillRect(b,f,k,j);e.restore();e.fillStyle=l;e.fillRect(b,f+j/2,k,j/2);e.save();e.fillStyle=a.states[c.__state].color;e.shadowColor="#000000";e.shadowBlur=2;e.shadowOffsetX=0;e.shadowOffsetY=0;e.beginPath();e.arc(b+k-j/4-1,f+3*(j/4),j/4-3,0,2*Math.PI,!0);e.closePath();e.fill();e.restore();n=function(a,b,c,d,f){e.fillStyle=
b;b=e.measureText(a);if(b.width>f)for(;""!==a;){b=e.measureText(a+"...");if(b.width<=f){a+="...";break}a=a.substr(0,a.length-1)}e.fillText(a,c,d,f)};l=0;""!==g&&(e.font="bold "+0.7*(j/2)+"px Helvetica, Arial, sans-serif",e.textBaseline="top",l=e.measureText(g),n(g,q,b+k-l.width-4,f+2,l.width),l=l.width);e.font=0.7*(j/2)+"px Helvetica, Arial, sans-serif";e.textBaseline="top";n(c.name(),h,b+4,f+2,k-l-8);n(c.state(),q,b+4,f+j/2+2,k-j/2-8);a.annotation(c,"debugger_x",b);a.annotation(c,"debugger_y",f);
a.annotation(c,"debugger_w",k)}return d},0)}a.dbg_state_invalid.components=!0;a.dbg_state_invalid.states=!0}};a.latch("ComponentJS:log",function(d){var b=!1;null!==a.dbg&&(a.dbg_log(d),b=!0);return b});a.latch("ComponentJS:state-change",function(){a.dbg_update()});a.latch("ComponentJS:state-invalidate",function(d){a.dbg_state_invalidate(d)})});
