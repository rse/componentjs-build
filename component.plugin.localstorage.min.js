/*
**  ComponentJS -- Component System for JavaScript <http://componentjs.com>
**  Copyright (c) 2009-2013 Ralf S. Engelschall <http://engelschall.com>
**
**  This Source Code Form is subject to the terms of the Mozilla Public
**  License, v. 2.0. If a copy of the MPL was not distributed with this
**  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

ComponentJS.plugin("localstorage",function(d,f,a){if("undefined"===d.istypeof(a.localStorage))throw d.exception("plugin:localstorage",'sorry, mandatory HTML5 "localStorage" facility not supported by run-time environment');if("undefined"===d.istypeof(a.JSON))throw d.exception("plugin:localstorage",'sorry, mandatory JavaScript "JSON" encoding/decoding not supported by run-time environment');if("undefined"===typeof a.document||"undefined"===typeof a.document.location||"undefined"===typeof a.document.location.pathname)throw d.exception("plugin:localstorage",
'sorry, mandatory DOM "document location" facility not supported by run-time environment');var e=function(c){var b;b="ComponentJS:store:"+a.document.location.pathname;return b+=":"+c.path("/")};d.latch("ComponentJS:store-load",function(c){var b=e(c),b=a.localStorage.getItem(b);"string"===typeof b&&(c.__store=a.JSON.parse(b))});d.latch("ComponentJS:store-save",function(c){var b=e(c);c=a.JSON.stringify(c.__store);"{}"===c?a.localStorage.removeItem(b):a.localStorage.setItem(b,c)})});
